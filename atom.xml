<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Just Be Unreserved!</title>
  <subtitle>学无止境。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.easydone.cn/"/>
  <updated>2017-01-02T06:37:43.000Z</updated>
  <id>http://www.easydone.cn/</id>
  
  <author>
    <name>Ailurus</name>
    <email>woshiliangzhitao@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ProGuard在插件化里的应用</title>
    <link href="http://www.easydone.cn/2017/01/02/"/>
    <id>http://www.easydone.cn/2017/01/02/</id>
    <published>2017-01-02T02:48:03.000Z</published>
    <updated>2017-01-02T06:37:43.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;p&gt;Android 里比较常见的混淆方案就是 &lt;a href=&quot;https://www.guardsquare.com/en/proguard&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ProGuard&lt;/a&gt; 和 &lt;a href=&quot;https://www.guardsquare.com/en/dexguard&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;DexGuard&lt;/a&gt;，都是 GuardSquare 的产品，前者免费，后者收费；同时，GuardSquare 还推出了 iOS 的混淆方案 &lt;a href=&quot;https://www.guardsquare.com/en/ixguard&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iXGuard&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我们用的方案是 ProGuard，因此这里的讨论只针对 ProGuard，源码见这里 &lt;a href=&quot;https://sourceforge.net/projects/proguard/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://sourceforge.net/projects/proguard/&lt;/a&gt; 。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;功能&quot;&gt;&lt;a href=&quot;#功能&quot; class=&quot;headerlink&quot; title=&quot;功能&quot;&gt;&lt;/a&gt;功能&lt;/h1&gt;&lt;p&gt;ProGuard 为我们做了这么几项工作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;shink（压缩）；&lt;/li&gt;
&lt;li&gt;optimize（优化）；&lt;/li&gt;
&lt;li&gt;obfuscate（混淆）；&lt;/li&gt;
&lt;li&gt;preverify（预校验）；&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也就是说我们常说的混淆，并不仅仅指的是混淆，而是 ProGuard，而混淆只是其多个功能里的一个。在 Android 里，现在 ProGuard 的实现方式实际上有两种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;一种是传统的方式，在 proguard.pro 文件里配置规则，这种方式，更便于集中管理，这里有一点需要注意，proguardFile 是可以配置多个的，我们的插件化里，有一个公共的 proguard-rules-base.pro，是归所有模块共用的，还有一个 proguard-rules.pro，这是每个模块独有的；&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-2@2x.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-1@2x.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;另一种是引入 support-annotation 包，使用 @keep 注解，这种方式，与日常的开发结合更紧密。&lt;br&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-0@2x.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;shink&quot;&gt;&lt;a href=&quot;#shink&quot; class=&quot;headerlink&quot; title=&quot;shink&quot;&gt;&lt;/a&gt;shink&lt;/h3&gt;&lt;p&gt;的目的是为了移除在 App 运行过程中，用不到的类和方法，这样可以缩减方法数，进而缩小  Apk 体积，是避免达到 65535 方法数的一个很好的措施。但是由于我们的插件化方案，对于这一步，我们就要慎之又慎，因为每个模块都是独立的 Apk，虽然不存在了 65535 的问题，但是一些会被其他模块调用但是在自身模块却不会调用的类或方法，经过 ProGuard 之后，就会被 shink 掉，此时就会有 ClassNotFountException 或 NoSuchMethodError，这种一般也比较好解，根据报错，将对应的类或方法 keep 掉即可。详细参数介绍看这里&lt;a href=&quot;https://www.guardsquare.com/en/proguard/manual/usage#shrinkingoptions&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shrinkingoptions&lt;/a&gt; 。&lt;/p&gt;
&lt;h3 id=&quot;optimize&quot;&gt;&lt;a href=&quot;#optimize&quot; class=&quot;headerlink&quot; title=&quot;optimize&quot;&gt;&lt;/a&gt;optimize&lt;/h3&gt;&lt;p&gt;可以在字节码级别对代码进行优化，默认启用，可以设置不启用。详细参数介绍可以看这里&lt;a href=&quot;https://www.guardsquare.com/en/proguard/manual/usage#optimizationoptions&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;optimizationoptions&lt;/a&gt; 。经过优化，可能会删除一些 log 信息，或者删除被调用没有返回值的方法，或者一些常亮引用直接就使用字符串数字本身了，但是需要注意的是对于 library 里是无效的，同样它可以合并接口，通过减少类来优化。对于我们插件化来说，就也可能出现跟 shink 一样的情况，也需要注意。&lt;/p&gt;
&lt;h3 id=&quot;obfuscate&quot;&gt;&lt;a href=&quot;#obfuscate&quot; class=&quot;headerlink&quot; title=&quot;obfuscate&quot;&gt;&lt;/a&gt;obfuscate&lt;/h3&gt;&lt;p&gt;就很好理解了，也就是我们经常说的混淆，通过设置一些字符，将我们代码里的类名、方法名、变量名替换为这些设置的字符，这些字符组合起来就是一个字典，默认的字典就是我们常常看到的 abcd 之类的，我们可以自己指定一些自定义的字典，增加反编译难度，主要是这样三个参数：&lt;code&gt;-obfuscationdictionary filename&lt;/code&gt; &lt;code&gt;-classobfuscationdictionary filename&lt;/code&gt; &lt;code&gt;-packageobfuscationdictionary filename&lt;/code&gt;，在 proguard.pro 里配置一下就可以了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-9@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;最终的混淆结果就像下面这样：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-10@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;详细参数介绍看这里&lt;a href=&quot;https://www.guardsquare.com/en/proguard/manual/usage#obfuscationoptions&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;obfuscationoptions&lt;/a&gt; 。混淆是保护 App 很好的手段，正常情况下，我们根据编译过程中的 warning 警告就可以确定哪些类不应该被混淆，但是由于我们的插件化方案，造成了编译期的警告全都不可用了，只能通过运行期的报错信息来处理混淆。&lt;/p&gt;
&lt;h3 id=&quot;preverify&quot;&gt;&lt;a href=&quot;#preverify&quot; class=&quot;headerlink&quot; title=&quot;preverify&quot;&gt;&lt;/a&gt;preverify&lt;/h3&gt;&lt;p&gt;预校验从 Java6 开始被支持，Java6 上是可选的，Java7 以上是必须的，但是 Android 上是可选的，在我们的工程里，关闭了这个选项，这也是官方推荐的，因此暂时也就没有了解。&lt;/p&gt;
&lt;p&gt;这样之后，我们会看到，我们的主要工作主要集中在 shink、optimize 和 obfuscate 这三项上。&lt;/p&gt;
&lt;h2 id=&quot;compile-VS-runtime&quot;&gt;&lt;a href=&quot;#compile-VS-runtime&quot; class=&quot;headerlink&quot; title=&quot;compile VS runtime&quot;&gt;&lt;/a&gt;compile VS runtime&lt;/h2&gt;&lt;p&gt;事实上，ProGuard 是会在编译过程中处理所有的类，因此，正常情况下，在编译过程中的 warning 信息是非常有用的，如果我们能处理掉在编译过程中所有的 warning 信息，那将会对整个 ProGuard 的工作有非常大的帮助。而且编译期的 warning 信息是非常容易解决的，根据提示将对应的类或类成员 keep 掉即可。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-3@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;但是，既然这是正常情况下，就肯定有一些非正常情况，在插件化里，由于类的调用方式已经改变了，可能有大量的编译器依赖并不会被打进最终的 Apk 里，因此编译过程中的 warning 信息就几乎完全不可用了。所以，还是要从运行期入手，通过运行期的报错信息，来一点点地处理，这极其低效，然而在我的有限理解里却是最有效。&lt;/p&gt;
&lt;h2 id=&quot;产物&quot;&gt;&lt;a href=&quot;#产物&quot; class=&quot;headerlink&quot; title=&quot;产物&quot;&gt;&lt;/a&gt;产物&lt;/h2&gt;&lt;p&gt;经过 ProGuard 处理之后，会生成四个文件：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-4@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dump.txt 描述apk文件中所有类文件的内部结构&lt;/li&gt;
&lt;li&gt;mapping.txt 列出了类、方法、成员的原貌与混淆后的映射表。在收到错误报告时，可以用它翻译混淆后的堆栈信息。参数为 -printmapping。&lt;/li&gt;
&lt;li&gt;seeds.txt 列出未混淆的类与成员。参数为 -printseeds。&lt;/li&gt;
&lt;li&gt;usage.txt 列出从apk中清除的无用代码。参数为 -printusage。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;根据上面的解释，我们可以发现 mapping.txt、seeds.txt、usage.txt 对于我们的 ProGuard 工作是非常重要的。通过分析它们，我们可以扩大混淆范围，尽可能精准地确定混淆信息。&lt;/p&gt;
&lt;p&gt;ProGuard 提供了 &lt;strong&gt;ReTrace&lt;/strong&gt; 功能，也就是反混淆功能。混淆之后，堆栈信息会变得很难看懂，这时候就需要 ReTrace 出场了，通过 mapping.txt，可以还原被混淆后的堆栈信息。用起来也很简单，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;java -jar retrace.jar [options...] mapping_file [stacktrace_file]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;工具&quot;&gt;&lt;a href=&quot;#工具&quot; class=&quot;headerlink&quot; title=&quot;工具&quot;&gt;&lt;/a&gt;工具&lt;/h2&gt;&lt;p&gt;一些反编译工具能够帮助我们更好地完成 ProGuard 工作，通过一些措施，使反编译工具失效，也能更好地达到保护 App 的目的。&lt;/p&gt;
&lt;h3 id=&quot;Jadx&quot;&gt;&lt;a href=&quot;#Jadx&quot; class=&quot;headerlink&quot; title=&quot;Jadx&quot;&gt;&lt;/a&gt;Jadx&lt;/h3&gt;&lt;p&gt;最常用的就是 &lt;a href=&quot;https://github.com/skylot/jadx&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Jadx&lt;/a&gt; 了，可以直接反编译 apk，apk 里的二进制 xml、dex 都可以被反编译出来，如下截图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-5@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;但是 jadx 并不能反编译 jar 包和 dex 文件&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;其他的诸如 &lt;a href=&quot;https://github.com/pxb1988/dex2jar&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;dex2jar&lt;/a&gt;，&lt;a href=&quot;https://github.com/iBotPeaches/Apktool&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Apktool&lt;/a&gt;，&lt;a href=&quot;https://github.com/JesusFreke/smali&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;smali/baksmali&lt;/a&gt;，&lt;a href=&quot;https://bytecodeviewer.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BytecodeViewer&lt;/a&gt; 等，也都不错，不过都不如 jadx 用起来简单。前三者也没有 GUI 工具，功能也不够丰富。&lt;/p&gt;
&lt;h3 id=&quot;BytecodeViewer&quot;&gt;&lt;a href=&quot;#BytecodeViewer&quot; class=&quot;headerlink&quot; title=&quot;BytecodeViewer&quot;&gt;&lt;/a&gt;BytecodeViewer&lt;/h3&gt;&lt;p&gt;值得一提的是 &lt;code&gt;BytecodeViewer&lt;/code&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;它像 jadx 一样，也提供了 GUI 工具；&lt;/li&gt;
&lt;li&gt;对于 Java 的反编译提供了更多种方案，理论上应该是几种工具里反编译最准确，可定制性也最强的；&lt;/li&gt;
&lt;li&gt;更新也很快；&lt;/li&gt;
&lt;li&gt;比 jadx 更强大的一点是，它还可以反编译 jar 和 dex；&lt;/li&gt;
&lt;li&gt;而且更加难能可贵的是，它不仅提供了 class 的反编译，还可以可视化看到 smali 代码（如下图）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-6@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-7@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;但是实际上它对 apk 的支持并不好，经常会出问题。而且对于&lt;strong&gt;插件化&lt;/strong&gt;方案来讲，它有一个致命的缺陷，就是不支持一个 apk 里存在多个&lt;code&gt;packageId&lt;/code&gt;，一旦 apk 里有多个 &lt;code&gt;packageId&lt;/code&gt;，工具就会 crash。&lt;/p&gt;
&lt;p&gt;除了这些专门针对 Android 的反编译工具之外，还有一些针对 Java 的反编译工具，也可以参考一下，如 CFR、Procyon/&lt;a href=&quot;https://github.com/deathmarine/Luyten&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;luyten&lt;/a&gt;，&lt;a href=&quot;https://github.com/java-decompiler/jd-gui/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;JD-GUI&lt;/a&gt; 等，前两者比 JD-GUI 更准确，也更强大稳定。&lt;/p&gt;
&lt;h2 id=&quot;源码解析&quot;&gt;&lt;a href=&quot;#源码解析&quot; class=&quot;headerlink&quot; title=&quot;源码解析&quot;&gt;&lt;/a&gt;源码解析&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;ProGuard &lt;/strong&gt;的源码主要分为几个部分：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如何读取输入的文件（readInput）？&lt;/li&gt;
&lt;li&gt;shink、optimize、obfuscate、preverify 如何处理文件（Android 新的编译工具 Jack 执行任务的过程已经包含了 ProGuard，说明 ProGuard 不仅能处理 class？存疑。）？&lt;/li&gt;
&lt;li&gt;如何将输入的文件与 ProGuard 参数组合（Configuration）？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这里只是大致分析一下如何读取，obfuscate 如何工作，以及 ProGuard 的参数配置部分。optimize 代码量太大了，以后再慢慢看，preverify 项目里没用到，shink 要简单不少，因此这三部分就不作分析了。&lt;/p&gt;
&lt;h3 id=&quot;readInput&quot;&gt;&lt;a href=&quot;#readInput&quot; class=&quot;headerlink&quot; title=&quot;readInput&quot;&gt;&lt;/a&gt;readInput&lt;/h3&gt;&lt;p&gt;先找到 &lt;code&gt;ProGuard#main&lt;/code&gt; 方法，在这里经过一系列 check，调到 &lt;code&gt;readInput()&lt;/code&gt; 方法，然后实例化 &lt;code&gt;InputReader&lt;/code&gt;，并调用 &lt;code&gt;readInput(String, ClassPath, DataEntryReader)&lt;/code&gt;，通过循环遍历读取 &lt;code&gt;class path entry&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Reads the given input class path entry.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;readInput&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String messagePrefix, ClassPathEntry classPathEntry, DataEntryReader dataEntryReader)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Create a reader that can unwrap jars, wars, ears, and zips.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DataEntryReader reader =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                DataEntryReaderFactory.createDataEntryReader(messagePrefix,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        classPathEntry,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        dataEntryReader);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Create the data entry pump.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DirectoryPump directoryPump = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DirectoryPump(classPathEntry.getFile());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Pump the data entries into the reader.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        directoryPump.pumpDataEntries(reader);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException ex) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; (IOException) &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;string&quot;&gt;&quot;Can&#39;t read [&quot;&lt;/span&gt; + classPathEntry + &lt;span class=&quot;string&quot;&gt;&quot;] (&quot;&lt;/span&gt; + ex.getMessage() + &lt;span class=&quot;string&quot;&gt;&quot;)&quot;&lt;/span&gt;).initCause(ex);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;紧接着递归调用 &lt;code&gt;readFiles&lt;/code&gt; 方法，读取每一个文件&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Reads the given subdirectory recursively, applying the given DataEntryReader&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * to all files that are encountered.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;readFiles&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(File file, DataEntryReader dataEntryReader)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Pass the file data entry to the reader.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dataEntryReader.read(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; FileDataEntry(directory, file));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (file.isDirectory()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Recurse into the subdirectory.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        File[] listedFiles = file.listFiles();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; index = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; index &amp;lt; listedFiles.length; index++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            File listedFile = listedFiles[index];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                readFiles(listedFile, dataEntryReader);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; (IOException) &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;string&quot;&gt;&quot;Can&#39;t read [&quot;&lt;/span&gt; + listedFile.getName() + &lt;span class=&quot;string&quot;&gt;&quot;] (&quot;&lt;/span&gt; + e.getMessage() + &lt;span class=&quot;string&quot;&gt;&quot;)&quot;&lt;/span&gt;).initCause(e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;由这里，我们可以看到，关键点在 &lt;code&gt;DataEntryReader&lt;/code&gt;，这是个接口，有不同的实现类，这会根据传入的 file 的不同，选择不同的实现类去实例化。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20161220-8.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;以 ClassReader 为例，继续下面的分析&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Implementations for DataEntryReader.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DataEntry dataEntry)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Get the input stream.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        InputStream inputStream = dataEntry.getInputStream();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Wrap it into a data input stream.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DataInputStream dataInputStream = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DataInputStream(inputStream);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Create a Clazz representation.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Clazz clazz;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isLibrary) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            clazz = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LibraryClass();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            clazz.accept(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LibraryClassReader(dataInputStream, skipNonPublicLibraryClasses, skipNonPublicLibraryClassMembers));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            clazz = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ProgramClass();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            clazz.accept(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ProgramClassReader(dataInputStream));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Apply the visitor, if we have a real class.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String className = clazz.getName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (className != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!dataEntry.getName().replace(File.pathSeparatorChar, ClassConstants.PACKAGE_SEPARATOR).equals(className + ClassConstants.CLASS_FILE_EXTENSION) &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    warningPrinter != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                warningPrinter.print(className,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;string&quot;&gt;&quot;Warning: class [&quot;&lt;/span&gt; + dataEntry.getName() + &lt;span class=&quot;string&quot;&gt;&quot;] unexpectedly contains class [&quot;&lt;/span&gt; + ClassUtil.externalClassName(className) + &lt;span class=&quot;string&quot;&gt;&quot;]&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            clazz.accept(classVisitor);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dataEntry.closeInputStream();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception ex) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; (IOException) &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;string&quot;&gt;&quot;Can&#39;t process class [&quot;&lt;/span&gt; + dataEntry.getName() + &lt;span class=&quot;string&quot;&gt;&quot;] (&quot;&lt;/span&gt; + ex.getMessage() + &lt;span class=&quot;string&quot;&gt;&quot;)&quot;&lt;/span&gt;).initCause(ex);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;值得一提的是，在 ProGuard 源码里用了大量的&lt;strong&gt;装饰器模式&lt;/strong&gt;和&lt;strong&gt;访问者模式&lt;/strong&gt;，代码阅读起来还是有一些困难。&lt;/p&gt;
&lt;p&gt;在上面的代码里，&lt;code&gt;Clazz&lt;/code&gt; 作为一个 &lt;code&gt;Element（抽象元素）&lt;/code&gt;，其实现类  &lt;code&gt;LibraryClass&lt;/code&gt; 和 &lt;code&gt;ProgramClass&lt;/code&gt; 是 &lt;code&gt;ConcreteElement（具体元素）&lt;/code&gt;，&lt;code&gt;ClassVisitor&lt;/code&gt; 作为一个 &lt;code&gt;Visitor（抽象访问者）&lt;/code&gt;，其实现类 &lt;code&gt;ProgramClassReader&lt;/code&gt; 和 &lt;code&gt;LibraryClassReader&lt;/code&gt; 都是 &lt;code&gt;ConcreteVisitor（具体访问者）&lt;/code&gt;，元素调用 &lt;code&gt;accept&lt;/code&gt; 方法（需要传入参数访问者），而在元素的 accept 方法里（元素里还有诸多其他的业务方法），又调用了访问者的 &lt;code&gt;visitProgramClass(ProgramClass programClass)&lt;/code&gt; 或 &lt;code&gt;visitLibraryClass(LibraryClass libraryClass)&lt;/code&gt;方法，从而实现『双重分派』，这里实际上少了一个 &lt;code&gt;ObjectStructure（对象结构）&lt;/code&gt;的角色和增加删除元素的方法，对象结构是元素的集合。下面就是简单的图示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/proguard/20170102-8@2x.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;如果是完整的访问者模式，这里需要修改一下，增加对象结构，然后编译集合，这样就可以使每一个元素都调用到访问者的 accept 方法，再加上增加元素和删除元素的方法。如果新增加元素，只需要调用增加删除元素的方法即可，而无需修改其他代码。&lt;/p&gt;
&lt;h3 id=&quot;obfuscate-1&quot;&gt;&lt;a href=&quot;#obfuscate-1&quot; class=&quot;headerlink&quot; title=&quot;obfuscate&quot;&gt;&lt;/a&gt;obfuscate&lt;/h3&gt;&lt;p&gt;对访问者模式有一个大致了解之后，obfuscate 的代码也就不那么难读懂了。在这里 ClassPool 是元素，ClassPoolVistor 是访问者。调用 Obfuscator 的 execute 方法，在这个方法里就按照下面的步骤执行：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;先去 check 一下 keep 规则、applyMapping、printMapping 是否同时为空，同时为空就抛出异常，否则继续；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;清空 visitor 信息；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;根据类成员的名字是否要全局对应，如果是的话，就 link 所有的类，否则就 link 所有类里的非 private 方法，具体做法是：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ClassVisitor memberInfoLinker = configuration.useUniqueClassMemberNames ? (ClassVisitor)&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AllMemberVisitor(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MethodLinker()) : (ClassVisitor)&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BottomClassFilter(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MethodLinker());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;programClassPool.classesAccept(memberInfoLinker);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;libraryClassPool.classesAccept(memberInfoLinker);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;classesAccept&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ClassVisitor classVisitor)&lt;/span&gt; &lt;/span&gt;&amp;#123; &lt;span class=&quot;comment&quot;&gt;//classesAccept 是 ClassPool 这个元素里的一个业务方法，而在这个方法里，又将 memberInfoLinker 作为一个访问者，通过循环遍历，处理每一个类。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Iterator iterator = classes.values().iterator();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (iterator.hasNext()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Clazz clazz = (Clazz) iterator.next();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        clazz.accept(classVisitor);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;创建标记为 seed（参照上文的 seeds.txt） 的 visitor，并标记 seed；&lt;/p&gt;
&lt;figure class=&quot;highlight actionscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NameMarker nameMarker = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NameMarker();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ClassPoolVisitor classPoolvisitor =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ClassSpecificationVisitorFactory.createClassPoolVisitor(configuration.keep,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                            nameMarker,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                            nameMarker,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                            &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                            &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                            &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 又是访问者模式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;programClassPool.accept(classPoolvisitor);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;libraryClassPool.accept(classPoolvisitor);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;keep library 里的 class 和 library 里的 class member；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;keep 返回动态方法调用的类成员；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;标记需要被 keep 的 attributes；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;keep 方法的参数和参数类型；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;移除被标记为丢弃的 attitutes；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;applyMapping；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;为所有的类指定新的名字（应用混淆字典）；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;为所有的类成员指定新的名字；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;解决在替换名字过程中可能引起的冲突；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果有 warning 新的话，就打印 warning 信息；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;移除没有用到的常量。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这就是整个混淆的过程。以上步骤除了第一步的 check 之外，无一例外全都是通过访问者模式实现的。&lt;/p&gt;
&lt;h2 id=&quot;常见问题（runtime）&quot;&gt;&lt;a href=&quot;#常见问题（runtime）&quot; class=&quot;headerlink&quot; title=&quot;常见问题（runtime）&quot;&gt;&lt;/a&gt;常见问题（runtime）&lt;/h2&gt;&lt;p&gt;需要重点提及的一个问题就是因为&lt;strong&gt;间接依赖&lt;/strong&gt;，造成不该被混淆优化的类和类成员被混淆优化了。比如 Activity，Fragment 这种，类被打进了宿主里，其他模块引用的又是 BaseActivity 这种中间类，同时又没有通过 provided 去依赖，这样就会造成 Activity 被混淆了。实践过程中，有相当一部分问题都是这种原因造成的。我们现在的解决方案是，让所有的模块都 provided 了一份其他所有模块的 api，这样保证不会因为间接依赖而出问题，不过因为打包的时候会扫描所有的类，会造成编译速度会慢几秒钟。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;java.lang.ClassNotFoundException&lt;/p&gt;
&lt;p&gt;类找不到，keep 掉对应的类即可。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;java.lang.NoSuchMethodError&lt;/p&gt;
&lt;p&gt;方法找不到，keep 掉对应的方法即可。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Java.lang.UnsupportedOperationException: Required method xxx was not overridden&lt;/p&gt;
&lt;p&gt;方法没被重写，keep 掉对应的方法即可。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;java.lang.AbstractMethodError&lt;/p&gt;
&lt;p&gt;接口里方法和 new 出来的接口对象里实现的方法名不一致，需要保证它们是一致的。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;other&lt;/p&gt;
&lt;p&gt;其他问题，可以先把对应的类给 keep 掉，然后再去断点调试定位哪里出了问题。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;这就是我做 ProGuard 相关的工作时的一些经验。ProGuard 的工作其实是很不容易做的，这最需要耐心，很多问题有时候经验本身会显得更重要。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;p&gt;Android 里比较常见的混淆方案就是 &lt;a href=&quot;https://www.guardsquare.com/en/proguard&quot;&gt;ProGuard&lt;/a&gt; 和 &lt;a href=&quot;https://www.guardsquare.com/en/dexguard&quot;&gt;DexGuard&lt;/a&gt;，都是 GuardSquare 的产品，前者免费，后者收费；同时，GuardSquare 还推出了 iOS 的混淆方案 &lt;a href=&quot;https://www.guardsquare.com/en/ixguard&quot;&gt;iXGuard&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我们用的方案是 ProGuard，因此这里的讨论只针对 ProGuard，源码见这里 &lt;a href=&quot;https://sourceforge.net/projects/proguard/&quot;&gt;https://sourceforge.net/projects/proguard/&lt;/a&gt; 。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="Obfuscate" scheme="http://www.easydone.cn/tags/Obfuscate/"/>
    
      <category term="Optimize" scheme="http://www.easydone.cn/tags/Optimize/"/>
    
      <category term="Preverify" scheme="http://www.easydone.cn/tags/Preverify/"/>
    
      <category term="ProGuard" scheme="http://www.easydone.cn/tags/ProGuard/"/>
    
      <category term="Shink" scheme="http://www.easydone.cn/tags/Shink/"/>
    
  </entry>
  
  <entry>
    <title>一个不得已的解释</title>
    <link href="http://www.easydone.cn/2016/12/30/"/>
    <id>http://www.easydone.cn/2016/12/30/</id>
    <published>2016-12-30T12:32:52.000Z</published>
    <updated>2016-12-30T12:45:22.000Z</updated>
    
    <content type="html">&lt;p&gt;最近真是节奏不断…起因都是在朋友圈里说了一些人认为不该说的话。&lt;/p&gt;
&lt;p&gt;前两天被 drakeet 拉黑了，原因我也不想多说了。总之，当时反应是比较愕然，有那么一瞬间的失落，不过随即就消失了，慢慢地有一些生气一直到现在，不过并不在意，不会放在心上。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;再接下来的一件事就有点让人懊恼了，而且因为牵涉到的人，也会觉着有一些伤心。当然，像我这么看得开的人，绝对不可能会因为已经无可挽回的与自己没什么关系的事情，而造成的这种不好的情绪持续太久。但是又不能看着事态进一步扩展，让不明真相的人产生误会。于情于理，这样的解释都必不可少。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先，我要说明的是，我认识的做 Android 的人真不多，所以说的 dodola 在 Android 方面的造诣在我认识的做 Android 的人里至少能排进前五，这是经过深思熟虑的，而且我不会改；&lt;/li&gt;
&lt;li&gt;其次在深度方面，我觉着 dodola 钻研的要比代码家、秋百万、hyman 要深，这也是没问题的。&lt;ul&gt;
&lt;li&gt;我没有加 hyman 的微信，只是有关注他的公众号和博客，鸿洋基础很扎实，能把问题讲的很清楚，对于技术的传播促进作用非常大，我也从他的博客里学到了很多，这是我认为他比 dodola 厉害的地方。而且我也经常在鸿洋公众号里留言，在知乎上也对吹了他一波。所以，不要再别有用心地说我黑鸿洋了，这个论据不扎实。&lt;/li&gt;
&lt;li&gt;秋百万，我跟他交流很少，微信上基本没说过话，但是我也没有黑他的动机。当初，他说要举办一个读书的活动，转发微博送书，还说希望可以做成大家一起参与的形式，我看到后，立马给他在微信上发了100块钱的红包。虽然，我觉着他的群太严肃，不适合我，然后退群了，但是他为社区做的事情，是我很佩服的。同时他的管理、组织能力非常强。这些点上，他比 dodola 要厉害很多。而且，我也在知乎上吹过秋百万，并且在有人黑他的时候我也是极力维护的。所以，不要再别有用心地说我黑秋百万了，这个论据不扎实。&lt;/li&gt;
&lt;li&gt;最后是代码家，毫无疑问，他根本不在意这样的事情。他的状态是我最欣赏的，也是我希望能够达到的。当然，他的技术是毋庸置疑的，非常厉害，真正的全栈（但是，在 Android 方面，我依然认为 dodola 比他钻研的要深）。他对待技术已经不再苛求，更多地去享受生活。人的一生里，有很多很重要的事情，远不止代码和技术本身。做自己喜欢做的事，永远不用担心因为无法坚持做一件事而无法精通，完全凭借兴趣去享受生活。这是一般人无法达到的。我都已经说到这种地步了，还会有人相信我在黑代码家吗？所以，不要再别有用心地说我黑代码家了，这个论据不扎实。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我不喜欢把太多的时间花在社交上，我同样不喜欢这样的人，我虽然对技术追求不狂热，但是我认为这样整天把『我认识xxx大神』挂在嘴上的人，不值得深交。&lt;/p&gt;
&lt;p&gt;经常看到有人说要『做自己』，但是目力所及的全都是『人情赞』『人情吹』，你怎么『做自己』？『跪舔』是拿来开玩笑的，那么认真干什么？&lt;/p&gt;
&lt;p&gt;最后，再说一次，生活里有很多重要的事情可以去做，远不止代码和技术本身，况且这几天的事情，让我深深地感受到『技术单纯，但是做技术的人并不单纯』。做自己喜欢做的事，永远不要担心因为无法坚持做一件事而无法精通，完全凭借兴趣去享受生活。这样的生活很有意义。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近真是节奏不断…起因都是在朋友圈里说了一些人认为不该说的话。&lt;/p&gt;
&lt;p&gt;前两天被 drakeet 拉黑了，原因我也不想多说了。总之，当时反应是比较愕然，有那么一瞬间的失落，不过随即就消失了，慢慢地有一些生气一直到现在，不过并不在意，不会放在心上。
    
    </summary>
    
      <category term="随笔" scheme="http://www.easydone.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="解释" scheme="http://www.easydone.cn/tags/%E8%A7%A3%E9%87%8A/"/>
    
  </entry>
  
  <entry>
    <title>这一年</title>
    <link href="http://www.easydone.cn/2016/12/25/"/>
    <id>http://www.easydone.cn/2016/12/25/</id>
    <published>2016-12-25T14:46:45.000Z</published>
    <updated>2016-12-25T14:46:56.000Z</updated>
    
    <content type="html">&lt;p&gt;前些天，看了电影『驴得水』，朋友跟我讲，很心疼张一曼，我也回了个『嗯，心疼』，然后又接了句『也心疼周铁男』。在听到枪响之前，这是我最喜欢的一个角色，年轻、莽撞、单纯，枪响之后，这个人立马变成了自己曾经讨厌的样子。最近一直在问自己：忙忙碌碌一整年，如今的自己是个什么样子？&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;去年年底，确定了加入口袋，然后休息了一段时间，今年过完春节就直接过来了。如今再审视当初的决定，我很庆幸。一整年的时间里，懈怠过多少次，就被鼓励过多少次，也就成长了多少次。假如是放在一年前，我可能会觉着自己做不到现在这样。有时候我会想，假如没有那么多次的懈怠，而是一直奋不顾身的往前冲，是不是结果会更好一点？以我的性格，即便知道结果会更好，恐怕依然会有那么多次的懈怠。这一年的经历，我更加确信这是一个很好的团队，有最好的 HR，有最好的领导，有最好的伙伴。也正是因为这些亦师亦友的同事们，才会允许我有这么多的懈怠。&lt;/p&gt;
&lt;p&gt;如果只是看这过去的一年，也许还可以沾沾自喜。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;到现在，整个项目的平台化改造基本完成，还剩下一些细枝末节的工作，都是一些体力活，以后会慢慢完善。 &lt;/li&gt;
&lt;li&gt;工作之余看了15本书，有传记类、小说类、管理类、心理类…比之以前，通过读书开始更多的思考宏观层面的东西了。&lt;/li&gt;
&lt;li&gt;举行了婚礼，亲朋好友也终于都放心了。作为一个男人，终于下决心去承担自己应该承担的那份责任。&lt;/li&gt;
&lt;li&gt;被折磨了十多年鼻炎，终于下决心去做了手术，虽然没有彻底治愈，不过总算是有效果。&lt;/li&gt;
&lt;li&gt;看了两场很早之前就想去的奶茶刘若英的演唱会，而且第一场是很有纪念意义的这一年的第一天。&lt;/li&gt;
&lt;li&gt;认识了喜欢同样类型电影的新朋友，我想这会是一辈子的财富吧。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;然而在这一年的最后几天，依然开始莫名其妙地很焦虑，回想一下，多年以前自己的理想，如今越来越看不清楚。事到如今，终究是一事无成，没有长成十五岁的自己讨厌的样子，却也没有成为理想中的大人。在北京这样一个冰冷的城市的冰冷的冬天里，面对这样的自己，难免会让自己这模糊的未来显得更加虚无缥缈。我是一个很传统的人，从小到大，都在极力克制自己，在我所有的已经形成的观念里，努力守规矩是一件很重要的事，克制会创造幸福。我不喜欢迟到，不喜欢不上进，不喜欢把大量精力都浪费在社交上，不喜欢把太多的时间都浪费在睡觉上，不喜欢桌子上堆好多垃圾…然而即便如此，这么久了，还是一无所成。在中国这样一个如此重视家这个概念的国度里，我这样一个传统观念如此根深蒂固的人，就这样一直在离家几千里之外的地方飘啊飘啊飘啊…儿行千里母担忧啊，在几千里外的家里，越来越苍老的父亲母亲，还要承受为几千里之外的儿子的平安健康提心吊胆。这实在太让人沮丧了。每每念及于此，总会忍不住悲伤起来，有时候会觉着自己是不是一直都是错的…&lt;/p&gt;
&lt;p&gt;也许这一生就这样了吧。再往下想，正如即便事先知道面对困难不去懈怠会有更好的结果，我还是会懈怠一样，选择了这样的人生，已然成为了这样的自己，注定要在焦虑和安逸中度过每一个春夏秋冬，也许更应该放宽心，至少让家里的父母对自己放心，让自己不至于在畏首畏尾里蹉跎岁月。『我从来不曾爱过一个人会比海更深，奢求太多也注定无济于事』。经常会劝别人，既来之，则安之，要放宽心，这事没那么严重。这样放之天下皆准的道理，我讲起来最是得心应手。而我这么克制的人，当然也不可能会一直焦虑下去。不是每个人都能成为自己理想中的大人。比去年的这个时候，我让家人朋友更放心了，这就是我啊。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;前些天，看了电影『驴得水』，朋友跟我讲，很心疼张一曼，我也回了个『嗯，心疼』，然后又接了句『也心疼周铁男』。在听到枪响之前，这是我最喜欢的一个角色，年轻、莽撞、单纯，枪响之后，这个人立马变成了自己曾经讨厌的样子。最近一直在问自己：忙忙碌碌一整年，如今的自己是个什么样子？
    
    </summary>
    
      <category term="随笔" scheme="http://www.easydone.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="克制" scheme="http://www.easydone.cn/tags/%E5%85%8B%E5%88%B6/"/>
    
      <category term="焦虑" scheme="http://www.easydone.cn/tags/%E7%84%A6%E8%99%91/"/>
    
      <category term="责任" scheme="http://www.easydone.cn/tags/%E8%B4%A3%E4%BB%BB/"/>
    
  </entry>
  
  <entry>
    <title>故事要开始了吗</title>
    <link href="http://www.easydone.cn/2016/12/08/"/>
    <id>http://www.easydone.cn/2016/12/08/</id>
    <published>2016-12-08T09:46:02.000Z</published>
    <updated>2016-12-08T12:22:35.000Z</updated>
    
    <content type="html">&lt;p&gt;如何开办一个开发者大会？开发者们从来都不要求 CSDN、QCON 之流能够有多么高尚的追求，甚至极尽包容乃至允许平庸，然而无处不散发着的鸡贼气息，着实让人扫兴。今天去参加了 Google Developer Day 。无论从哪个角度看，Google 都为国内众多组织机构做了一个最好的示范，一家企业的价值观在整个大会的方方面面，每一个细节都体现的淋漓尽致。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最让人惊喜、最激动人心的莫过于 &lt;a href=&quot;developers.google.cn&quot;&gt;developers.google.cn&lt;/a&gt; 的回归，虽然对于搜索、Play 等服务在国内的落地不能盲目乐观，甚至仍然看不到任何希望，但是这已然成为众多开发者欢欣雀跃甚至热泪盈眶的事情。事实上，在技术开发领域，Google 一直都在，技术本身是没有界限的，即便在之前不翻墙无法访问 Google 的 developers 网站，Google 也一直在默默地做着自己的能做的工作，这也是为什么我们能在官网看到越来越多的中文文档。而如今，再也不用翻墙就可以看各种开发文档，下载各种开发工具，甚至有不少服务也已经可以更轻松地接入。有人已经不禁哼出来了：终于等到你，还好我没放弃…&lt;/p&gt;
&lt;p&gt;台上讲演的任何一位 Google 工程师，都没有无脑吹嘘自己现在做的工作多么多么厉害，也没有为自己所做出的成绩而沾沾自喜，而是非常的坦诚，遇到自己不会的东西，就说不会，讲到 Google 一而再地自己打自己脸，也会调侃戏谑，整个过程非常的轻松愉快，像是在聊天。还有很重要的一点，也是让国内众多所谓的xx大会汗颜的，那就是全部的讲演全程无广告。Google 当然有自己的 AdWords 和 Admob，但是 AdWords 和 Admob只是偌大的展区里的两个小展台，在面向开发者的主会场和分会场是完全没有广告的，而面向运营的 Ads 会场只有一个，更何况这是切实地在为中国的团队提供更加可行、有效、有价值的海外推广方案。而国内众多厂商，正式凭借 Google 在国内的提供的服务，走出了国门，在海外大展拳脚。&lt;/p&gt;
&lt;p&gt;还有不得不提的就是午餐供应。要知道，这是一场完全免费的大会，除了 Google 自己的社交平台账号，几乎没有做任何宣传，仍然吸引了非常多的人来参加，然而 Google 并没有因为如此多的人，而且没有任何门票收入，就降低对午餐的要求。我不知道 Google 自己的餐厅是不是也是同样的高大上，但是这午餐真的是惊到我了，我只能说：实在是太棒了！想想之前花了几千块钱买一张 CSDN、QCON 的票，听了一整天的广告，结果中午就给一盒饭，甚至有时候连吃饭的地方都没有，找个地儿蹲下就对付了。我的天呐，这都 21 世纪了，还能这样糊弄人，这是在欺负人没见过世面吗？&lt;/p&gt;
&lt;p&gt;跟 Google 这样的企业处在同一个时代，是多么幸运的一件事；能用 Google 提供的技术做出来产品，是多么幸运的一件事；能够用 Google 的理念去影响更多的人，是多么幸运的一件事。这仍然是一家会犯错、会作恶的企业，然而 Google 是如此的自由、真诚、伟大，以至于你可以永远对它充满期待。&lt;/p&gt;
&lt;p&gt;它总会给你惊喜。也许关于 Google 在中国的故事从来都不存在什么时候开始的问题，关于 Google 中国，故事一直都在继续。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;如何开办一个开发者大会？开发者们从来都不要求 CSDN、QCON 之流能够有多么高尚的追求，甚至极尽包容乃至允许平庸，然而无处不散发着的鸡贼气息，着实让人扫兴。今天去参加了 Google Developer Day 。无论从哪个角度看，Google 都为国内众多组织机构做了一个最好的示范，一家企业的价值观在整个大会的方方面面，每一个细节都体现的淋漓尽致。
    
    </summary>
    
      <category term="随笔" scheme="http://www.easydone.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="Google" scheme="http://www.easydone.cn/tags/Google/"/>
    
  </entry>
  
  <entry>
    <title>关于oasis的组件化思想的一些思考</title>
    <link href="http://www.easydone.cn/2016/09/25/"/>
    <id>http://www.easydone.cn/2016/09/25/</id>
    <published>2016-09-25T11:43:36.000Z</published>
    <updated>2016-12-08T11:21:04.000Z</updated>
    
    <content type="html">&lt;p&gt;插件化技术发展到现在其实已经很成熟了，但是相应的问题，如果没有真正地去实践过，根本不了解其中有多少问题，会牵涉到多少技术细节，多少被外人膜拜的外表光鲜的技术大牛都被『插件化』这三个字折磨地死去活来，这对于 Android 整个生态的损害也让人无法忽视。&lt;/p&gt;
&lt;p&gt;昨天的 MDCC ，冯森林老师提出了一个很有意思的思路『组件化』。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我们首先要想一下，我们做插件化的目的是什么？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为了满足产品随时上线的需求？&lt;/li&gt;
&lt;li&gt;为了修复因为我们对自己要求不严格而写出来的 bug ？&lt;/li&gt;
&lt;li&gt;为了向人炫耀自己的技术实力？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;很抱歉，如果是为了这些目的，那就真的太对不起自己是『开发者』这个如此高逼格的身份了。&lt;/p&gt;
&lt;p&gt;做插件化真正的目的：是为了去适应并行开发，是为了解耦各个模块，是为了避免模块之间的交叉依赖，是为了加快编译速度，从而提高并行开发效率。&lt;/p&gt;
&lt;p&gt;明确了这些，我们再来看插件化的结果，每个模块都支持独立运行测试，分为稳定的 release 版本和不稳定的 snapshot 版本，每个模块都高度解耦，没有交叉依赖，不会出现一个模块依赖了另一个模块，其中一个人改了这个模块的代码，对另一个模块造成影响。这时候，我们再看冯老师的『组件化』思想。&lt;/p&gt;
&lt;p&gt;那么这个『组件化』是什么意思呢？我说下我自己的理解，可能不对，还请指教：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;通过 gradle 配置的方式，将打 debug 包和 release 包分开。这样会有一个好处，开发一个模块，在 debug 的时候，可以打成一个 apk ，独立运行测试，可以完全独立于整个宿主 APP 的其他所有组件；待到要打 release 包的时候，再把这个模块作为一个 library ，打成 aar ，作为整个宿主 APP 的一部分。而 debug 和 release 的切换都是通过 gradle 配置，可以做到无缝切换。至于模块之间的跳转，可以用别名的方式，而不是用 Activity 和 Fragment 类名。这样所有的模块和宿主 APP 都是完全解耦的，彻底解决了并行开发的可能造成的交叉依赖等问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;按照这个思路，我们再来看看一些其他的细节：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在 Android 里有一个比较爽的一点是，作为 library 的时候，aar 里的引用依赖，在宿主 Application 里也有同样的引用依赖，并不会打包两份到宿主 Application 里；&lt;/li&gt;
&lt;li&gt;模块之间的跳转，除了使用别名的方式，我能想到的还有另外一种方式，同样是通过 gradle 脚本，将跳转用到的类打成一个 jar ，作为一个 API 服务提供给其他模块作为编译期依赖（provided）引入；&lt;/li&gt;
&lt;li&gt;各个 library 在 debug 的时候作为 apk ，要独立打包运行测试，这时就需要有一个启动 Activity ，而 library 是不需要的，我的想法是放置两个 AndroidManifest.xml ，使用 sourceSets 分别在 debug 和 release 的时候加载不同的 AndroidManifest.xml 。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;怎么样？看上去是不是很像插件化 Atlas ？然而这个方案没有任何『黑科技』，不牵涉任何 hook ，跟 Atlas 的区别就是无需关心不同的 Context ，无需再关心类、资源怎么去加载，无需关心 Context 的安全问题，无需关心不同机型的兼容适配…技术成本可能连 Atlas 的十分之一都不到！&lt;/p&gt;
&lt;p&gt;感兴趣的话，可以看看这个 slide 分享，地址在这儿&lt;a href=&quot;http://www.slideshare.net/oasisfeng/from-containerization-to-modularity&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;from-containerization-to-modularity&lt;/a&gt;，我也写了个小 sample 去实现这个想法&lt;a href=&quot;GitHub - liangzhitao/ComponentizationApp&quot;&gt;ComponentizationApp&lt;/a&gt;。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;插件化技术发展到现在其实已经很成熟了，但是相应的问题，如果没有真正地去实践过，根本不了解其中有多少问题，会牵涉到多少技术细节，多少被外人膜拜的外表光鲜的技术大牛都被『插件化』这三个字折磨地死去活来，这对于 Android 整个生态的损害也让人无法忽视。&lt;/p&gt;
&lt;p&gt;昨天的 MDCC ，冯森林老师提出了一个很有意思的思路『组件化』。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.easydone.cn/tags/Android/"/>
    
      <category term="Gradle" scheme="http://www.easydone.cn/tags/Gradle/"/>
    
      <category term="插件化" scheme="http://www.easydone.cn/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
      <category term="组件化" scheme="http://www.easydone.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>关于Android插件化的细枝末节</title>
    <link href="http://www.easydone.cn/2016/07/24/"/>
    <id>http://www.easydone.cn/2016/07/24/</id>
    <published>2016-07-24T07:59:55.000Z</published>
    <updated>2016-07-24T13:56:39.000Z</updated>
    
    <content type="html">&lt;p&gt;最近一直在做插件化相关的工作。现在最常见的方案就是来自阿里的 Atlas 和 360 的 DroidPlugin 了。按照我的理解，对于当前的大多数应用来讲，可能 Atlas 会更适合一些，因为它允许插件与宿主之间，甚至是插件之间可以有互动；而 DroidPlugin 的思想会更先进，可想象空间更大一些，理论上它可以启动任何一个第三方应用，比如虚拟化，可参照物就是 LBE 的平行空间。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;Atlas 并没有开源，&lt;a href=&quot;https://github.com/DroidPluginTeam/DroidPlugin&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;DroidPlugin&lt;/a&gt; 已开源，我们现在采用的方案是基于 Atlas 的，有兴趣的可以看看 &lt;a href=&quot;https://github.com/bunnyblue/ACDD&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ACDD&lt;/a&gt; ，核心思想都是一样。&lt;/p&gt;
&lt;p&gt;不管是插件化，还是热补丁，现在的方案都比较多，相应方案在 GitHub 上也都能找得到 demo ，Google 一下，也有不少文章，然而停留在 demo 和文章介绍阶段，始终与实际的生产开发有较大的距离，尤其是大部分文章还只是纸上谈兵，写文章的十之七八恐怕都没有真正的在自己的应用里实践过，而插件化最困难的部分就是实践过程中遇到各种细节和适配问题，还有对当前开发模式的影响也是怎么都绕不过去的问题。下面我大致列一下我们在实践过程中遇到的一些问题。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;插件怎么去引用宿主里的类？&lt;/li&gt;
&lt;li&gt;插件怎么去引用宿主的资源？&lt;/li&gt;
&lt;li&gt;插件化要给每个插件进行资源分段，该如何进行资源分段？&lt;/li&gt;
&lt;li&gt;为了让业务的同学更容易接受，怎么处理宿主的类和资源？&lt;/li&gt;
&lt;li&gt;在引用宿主的资源的时候，默认可用的 context 在插件化里是否依然可用？&lt;/li&gt;
&lt;li&gt;不同的资源类型，引用和处理方式是否相同？&lt;/li&gt;
&lt;li&gt;插件之间共用的一些类，是放在宿主里，还是在插件里开放出接口，该怎么样去考量？&lt;/li&gt;
&lt;li&gt;插件如何去开放接口，让其他插件引用？&lt;/li&gt;
&lt;li&gt;插件开放出了接口，其他插件又该怎样去引用？&lt;/li&gt;
&lt;li&gt;不同的插件都要引用同一个类和同一个资源，类和资源重复了该怎么办？&lt;/li&gt;
&lt;li&gt;加载各个插件时，怎么样知道各个插件的信息？&lt;/li&gt;
&lt;li&gt;插件版本该如何去管理？&lt;/li&gt;
&lt;li&gt;怎样实现 debug 和 release 开发的宿主和插件打包？&lt;/li&gt;
&lt;li&gt;应用启动时要加载那么多插件，怎么加速第一次启动？&lt;/li&gt;
&lt;li&gt;插件引用的宿主的类和资源发生改变，难道每次都要去每个插件里手动修改吗？&lt;/li&gt;
&lt;li&gt;四大组件的免注册是怎么回事？&lt;/li&gt;
&lt;li&gt;四大组件免注册了，是否还需要合并每个插件的 AndroidManifest ？&lt;/li&gt;
&lt;li&gt;在不允许手动拷贝的情况下，如何合并各个插件的 AndroidManifest ？&lt;/li&gt;
&lt;li&gt;宿主的方法数超过 65535 了，该怎么办？&lt;/li&gt;
&lt;li&gt;混淆问题怎么去处理？&lt;/li&gt;
&lt;li&gt;适配，还是适配。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;实际操作中，因为对开发的影响是不可避免的，多亏了有 gradle ，通过定制 gradle 脚本，插件，甚至是 SDK 组件，很多事情我们可以做到自动化，当然，凡事有利就有弊，在这个过程中，会发现相当多的正常开发遇不到的 gradle 的『bug』，因此，假如 gradle 玩不转，会有很多麻烦。目前大致能想到的就这么多，以后有想到了再补充吧。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近一直在做插件化相关的工作。现在最常见的方案就是来自阿里的 Atlas 和 360 的 DroidPlugin 了。按照我的理解，对于当前的大多数应用来讲，可能 Atlas 会更适合一些，因为它允许插件与宿主之间，甚至是插件之间可以有互动；而 DroidPlugin 的思想会更先进，可想象空间更大一些，理论上它可以启动任何一个第三方应用，比如虚拟化，可参照物就是 LBE 的平行空间。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.easydone.cn/tags/Android/"/>
    
      <category term="Plugin" scheme="http://www.easydone.cn/tags/Plugin/"/>
    
  </entry>
  
  <entry>
    <title>Scala之旅-函数式编程简介</title>
    <link href="http://www.easydone.cn/2016/05/12/"/>
    <id>http://www.easydone.cn/2016/05/12/</id>
    <published>2016-05-12T15:43:44.000Z</published>
    <updated>2016-05-12T16:19:32.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;函数式编程的特点&quot;&gt;&lt;a href=&quot;#函数式编程的特点&quot; class=&quot;headerlink&quot; title=&quot;函数式编程的特点&quot;&gt;&lt;/a&gt;函数式编程的特点&lt;/h2&gt;&lt;p&gt;Scalable 可伸缩。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;纯函数（Pure Function），或函数的纯粹性（Purity），没有副作用（Side Effect）。&lt;br&gt;副作用指状态的变化（mutation）。如修改全局变量（x+=y），抛出异常，IO读写，调用有副作用的函数。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;引用透明（Referential Transparency）。对于相同的输入，总是能得到相同的输出。&lt;br&gt;如果 f(x) 的参数 x 和函数体都是引用透明的，那么函数 f 就是纯函数。（反例：append）&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;strong&gt;函数是第一等公民（First-class Function）&lt;/strong&gt;，函数、对象、变量、类同一级，可以把函数当作参数传给另一个函数，也可以把函数当作返回值返回，也可以在函数体里定义函数等。&lt;/p&gt;
&lt;p&gt;一切都是计算，函数式编程中只有表达式，变量、函数都是表达式。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;高阶函数（High order Function）&lt;/strong&gt; 指把函数当作一个函数的输入或一个函数的输出。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;闭包（Closure）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;表达式求值策略&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;严格求值（Call By Value）和非严格求值（Call By Name）。&lt;/p&gt;
&lt;p&gt;惰性求值（Lazy Evaluation）定义时不求值，第一次使用时才求值。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;递归函数（Recursive Function）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;函数式编程里没有循环，使用递归实现循环。（性能）&lt;/p&gt;
&lt;p&gt;调优递归→尾递归（Tail Recursion）。&lt;/p&gt;
&lt;h2 id=&quot;优点&quot;&gt;&lt;a href=&quot;#优点&quot; class=&quot;headerlink&quot; title=&quot;优点&quot;&gt;&lt;/a&gt;优点&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;生产效率高；&lt;/li&gt;
&lt;li&gt;易于推理（Reasoning），对于给定的输入，总能得到确定的输出，调试方便；&lt;/li&gt;
&lt;li&gt;并行编程，适用于多核计算，云计算（Spark），在多个节点上运算，得到的结果都是相同的；&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h2&gt;&lt;p&gt;安装&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;brew install scala&amp;#10;brew install sbt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;终端编程&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scala&amp;#10;sbt console&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;函数式编程的特点&quot;&gt;&lt;a href=&quot;#函数式编程的特点&quot; class=&quot;headerlink&quot; title=&quot;函数式编程的特点&quot;&gt;&lt;/a&gt;函数式编程的特点&lt;/h2&gt;&lt;p&gt;Scalable 可伸缩。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;纯函数（Pure Function），或函数的纯粹性（Purity），没有副作用（Side Effect）。&lt;br&gt;副作用指状态的变化（mutation）。如修改全局变量（x+=y），抛出异常，IO读写，调用有副作用的函数。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;引用透明（Referential Transparency）。对于相同的输入，总是能得到相同的输出。&lt;br&gt;如果 f(x) 的参数 x 和函数体都是引用透明的，那么函数 f 就是纯函数。（反例：append）&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Scala" scheme="http://www.easydone.cn/categories/Scala/"/>
    
    
      <category term="Scala" scheme="http://www.easydone.cn/tags/Scala/"/>
    
  </entry>
  
  <entry>
    <title>所有的期待</title>
    <link href="http://www.easydone.cn/2016/05/08/"/>
    <id>http://www.easydone.cn/2016/05/08/</id>
    <published>2016-05-08T11:18:48.000Z</published>
    <updated>2016-05-09T00:09:06.000Z</updated>
    
    <content type="html">&lt;p&gt;五一回家，我办了婚礼。其实对于来说，这个仪式有没有倒并没有什么所谓，不过这总归是家里人的一桩心愿，了却了这桩心愿，以后的事才能真正集中精力去做其他的事情嘛。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;农村办婚礼，总是会有这样那样的习俗。不过基本上也都是家里人在忙，我自己除了当天和前一天，其他时候倒真没觉着累。亲朋好友，邻里乡亲，平常我不在家，也都见不着，甚至很多都已经生疏了，不记得名字和关系了，也都来帮忙了。中国人讲究人情关系，在大城市里，可能这人情关系总少不了蝇营狗苟，而在农村老家里，虽然也会有这样那样的市井甚至低俗小气，但总的来说，更多时候还是温情多一些，尤其是在邻里遇到红白事的时候。&lt;/p&gt;
&lt;p&gt;因为我们是过年的时候就定了要在五一办喜事，那会儿，就有不少或亲或不亲的乡里乡亲们给我家里送钱，毕竟娶媳妇儿要花不少钱嘛。听我爸妈讲，我的一位爷爷家里年轻人都不在家，也好久没回来过了，他平时只靠扫大街度日，一个月只有四五百块的工资，可还是给我们送过来1000块钱。还有另一位奶奶，也是孩子都不在家，平时和老伴儿过日子，以前老伴儿没生病的时候还可以出去打工，她负责家里的田地，老伴儿现在瘫痪在床，唯一的经济来源也没了，她只好捡破烂挣钱，即便如此，还是给送来了50块钱礼金。&lt;/p&gt;
&lt;p&gt;按照习俗，婚礼的前一天中午，在院子里摆一个大猪头，作为新郎，要行三跪九叩之礼，算是拜天；晚上，给祖先灵位前摆上火盆，要上香，敬酒，同样也有三跪九叩，这是拜祖先。作为传统，它看上去确实不合时宜，甚至是落后，然而对于家里人，这样的仪式既是对过去的几十年的情感的片刻升华，又包涵了对未来可能会有的各种状况的祝福。礼毕的时候，司仪让我分别跟爸妈拥抱，我妈瞬间就哭了，拥抱完毕，我一扭头，发现二姑已成为泪人儿。不管在外面多么风光落魄，家人永远都在。&lt;/p&gt;
&lt;p&gt;婚礼当天，很开心还有几个朋友也到场了，他们都是从远方特意赶回来，只为这一天，还有个朋友作为来宾代表上台致辞，多年以来，身边的人形形色色，来来往往，能说的上心里话，放心地把自己全部交出去的始终就这么几个。在这样的日子里，那些相濡以沫的回忆更加弥足珍贵。未来的某些日子里，他们也都会有自己的家庭，我也会揣着同样的心情去参加他们的婚礼。这就是朋友啊。&lt;/p&gt;
&lt;p&gt;还是习俗，我要带着她要在一个台子上，对所有的长辈们叩首认亲，认亲完毕，整个仪式就基本完成了。最后，需要向所有的来宾敬酒。这样，整个婚礼就完了。我跟媳妇儿在一块儿快五年了，认识快八年了，都是初恋，走到现在说简单也不简单。在一起之前，彼此眼里都只有优秀，在一块儿的日子里，相互嫌弃直到成为夫妻。一起走过的日子，真正回忆起来，全都是点滴琐碎，当初掀起的心绪波澜，如今看来都是芝麻绿豆的小事情，想要为这个人生中最重要的一次结合找到一个值得大书特书的标志性事件，却发现怎么也找不到。原来我们是在一起平淡了这么长时间，如此理所当然就完成了彼此的身份转变。&lt;/p&gt;
&lt;p&gt;农村里的生活挺简单的，能好好活着，家里人没病没灾就好。平时闲了就聚个摊儿打扑克聊天，有富余的钱可以偶尔下一次管子，看着孩子们成家立业、传宗接代，老了可以抱着孙子孙女逗乐，这就是他们对生活所有的期待。这在城里人看来可能太平淡乏味，即便是我，回到家里一天没有 WiFi ，也会感觉到浑身不自在，而在家里人看来，生活本来就应该如此。习惯了在大城市里的快节奏，跟媳妇俩人每天只有晚上能见到面，一起吃饭，有时候可能会因为加班，一整天也说不上一句话，这样的日子，没人会不觉着累。一回到老家，就可以跟家人坐在一起，一天三顿饭都在一起吃。这种温馨，一年里也没几天，因此每次都显得那么珍贵，而这也是我对生活所有的期待。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;五一回家，我办了婚礼。其实对于来说，这个仪式有没有倒并没有什么所谓，不过这总归是家里人的一桩心愿，了却了这桩心愿，以后的事才能真正集中精力去做其他的事情嘛。
    
    </summary>
    
      <category term="随笔" scheme="http://www.easydone.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="家人" scheme="http://www.easydone.cn/tags/%E5%AE%B6%E4%BA%BA/"/>
    
      <category term="生活" scheme="http://www.easydone.cn/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>当EventBus遇上RxJava</title>
    <link href="http://www.easydone.cn/2016/03/29/"/>
    <id>http://www.easydone.cn/2016/03/29/</id>
    <published>2016-03-29T13:26:48.000Z</published>
    <updated>2016-05-08T09:44:36.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h2&gt;&lt;p&gt;接触过 &lt;code&gt;EventBus&lt;/code&gt; 和 &lt;code&gt;RxJava&lt;/code&gt; 的都知道，可以用 &lt;code&gt;RxJava&lt;/code&gt; 来实现 &lt;code&gt;EventBus&lt;/code&gt;，网上随便一搜，就可以拿得到代码。但是究竟为什么可以这么做？却没有类似的文章作进一步的深度解析。（本文假定读者都已经了解 &lt;code&gt;EventBus&lt;/code&gt; 和 &lt;code&gt;RxJava&lt;/code&gt; 是什么，可以做什么。）&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RxBus&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; RxBus instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; SerializedSubject&amp;lt;Object, Object&amp;gt; subject;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RxBus&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subject = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SerializedSubject&amp;lt;&amp;gt;(PublishSubject.create());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; RxBus &lt;span class=&quot;title&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (RxBus.class) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    instance = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RxBus();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object object)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        subject.onNext(object);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;  &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Observable&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;toObservable&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Class&amp;lt;T&amp;gt; type)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; subject.ofType(type);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;hasObservers&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; subject.hasObservers();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到，代码非常简练，当 &lt;code&gt;RxJava&lt;/code&gt; 遇上 &lt;code&gt;EventBus&lt;/code&gt; ，居然会如此神奇~那么问题来了，为什么这段代码就可以实现 &lt;code&gt;EventBus&lt;/code&gt; 的功能？&lt;/p&gt;
&lt;p&gt;要搞明白这几个问题，我们得弄清楚这些东西。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;EventBus&lt;/code&gt; 是如何实现的？&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RxJava&lt;/code&gt; 满足了实现 &lt;code&gt;EventBus&lt;/code&gt; 的哪些条件？&lt;/li&gt;
&lt;li&gt;如何用 &lt;code&gt;RxJava&lt;/code&gt; 去封装一个 &lt;code&gt;EventBus&lt;/code&gt; ？&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;EventBus工作流程&quot;&gt;&lt;a href=&quot;#EventBus工作流程&quot; class=&quot;headerlink&quot; title=&quot;EventBus工作流程&quot;&gt;&lt;/a&gt;&lt;code&gt;EventBus&lt;/code&gt;工作流程&lt;/h2&gt;&lt;p&gt;简单讲，事件总线，顾名思义，分为两个概念，一个事件，即 Event ，一个总线，即 Bus ，这是在整个 APP 里一种规范地传递事件的方式。作为独立于项目里各个模块的 Application 级别的存在，可以很好地用来程序的解耦。使用大致有四个步骤：注册→发送→接收→取消注册。具体的源码分析，可以参看 codeKK 上 &lt;a href=&quot;http://www.trinea.cn/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Trinea&lt;/a&gt; 的 &lt;a href=&quot;http://a.codekk.com/detail/Android/Trinea/EventBus%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;EventBus源码解析&lt;/a&gt; 和 &lt;a href=&quot;http://www.kymjs.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kymjs张涛&lt;/a&gt; 的 &lt;a href=&quot;http://kymjs.com/column/resourcecode.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;EventBus源码研读&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;更重要的一点，&lt;code&gt;RxBus&lt;/code&gt; 的重点应该在 &lt;code&gt;Bus&lt;/code&gt; 上，而不是 &lt;code&gt;RxJava&lt;/code&gt; 上。用 &lt;code&gt;RxJava&lt;/code&gt; 去实现 &lt;code&gt;EventBus&lt;/code&gt; 的思想。因此，应该把分析 &lt;code&gt;EventBus&lt;/code&gt; 作为一个重点。&lt;/p&gt;
&lt;p&gt;我们来看看要实现一个 &lt;code&gt;EventBus&lt;/code&gt; 需要满足什么条件。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;获取一个 &lt;code&gt;EventBus&lt;/code&gt; 实例，可以用单例，也可以用 &lt;code&gt;Builder&lt;/code&gt;；&lt;/li&gt;
&lt;li&gt;注册 &lt;code&gt;EventBus&lt;/code&gt; 和取消注册 &lt;code&gt;EventBus&lt;/code&gt;；&lt;/li&gt;
&lt;li&gt;发送和接收事件的方法。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;RxJava-amp-amp-EventBus&quot;&gt;&lt;a href=&quot;#RxJava-amp-amp-EventBus&quot; class=&quot;headerlink&quot; title=&quot;RxJava &amp;amp;&amp;amp; EventBus&quot;&gt;&lt;/a&gt;&lt;code&gt;RxJava&lt;/code&gt; &amp;amp;&amp;amp; &lt;code&gt;EventBus&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;要实现 &lt;code&gt;EventBus&lt;/code&gt; 需要满足的条件，在 &lt;code&gt;RxJava&lt;/code&gt; 里是如何体现的呢？&lt;/p&gt;
&lt;p&gt;首先我们需要明确的是，&lt;code&gt;EventBus&lt;/code&gt; 里都有哪些角色：&lt;code&gt;Event&lt;/code&gt;、&lt;code&gt;Subscriber&lt;/code&gt;、&lt;code&gt;Publisher&lt;/code&gt;，也就是说需要&lt;code&gt;Event&lt;/code&gt;、&lt;code&gt;Observer&lt;/code&gt;、&lt;code&gt;Observable&lt;/code&gt;，Event 自不必说，在 &lt;code&gt;RxJava&lt;/code&gt; 里既能充当&lt;code&gt;Observer&lt;/code&gt;，又能充当&lt;code&gt;Observable&lt;/code&gt;的对象就是 &lt;code&gt;Subject&lt;/code&gt;，而 &lt;code&gt;Subject&lt;/code&gt; 是线程非安全的，我们要构造一个线程安全的 &lt;code&gt;Subject&lt;/code&gt; ，需要用到它的子类 &lt;code&gt;SerializedSubject&lt;/code&gt;，而实际使用的时候，我们的观察者只需要订阅发生之后的，来自 &lt;code&gt;Observable&lt;/code&gt; 的数据，因此还需要给 &lt;code&gt;SerializedSubject&lt;/code&gt; 传入 &lt;code&gt;PublishSubject&lt;/code&gt; 作为参数。&lt;/p&gt;
&lt;h3 id=&quot;获取Bus实例&quot;&gt;&lt;a href=&quot;#获取Bus实例&quot; class=&quot;headerlink&quot; title=&quot;获取Bus实例&quot;&gt;&lt;/a&gt;获取&lt;code&gt;Bus&lt;/code&gt;实例&lt;/h3&gt;&lt;p&gt;一个单例即可，当然，&lt;code&gt;EventBus&lt;/code&gt; 还提供了使用 &lt;code&gt;Builder&lt;/code&gt; 创建实例的方法，可根据具体情况自行实现；&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; RxBus instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RxBus&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	subject = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SerializedSubject&amp;lt;&amp;gt;(PublishSubject.create());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; RxBus &lt;span class=&quot;title&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (RxBus.class) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                instance = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RxBus();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;注册和取消注册Bus&quot;&gt;&lt;a href=&quot;#注册和取消注册Bus&quot; class=&quot;headerlink&quot; title=&quot;注册和取消注册Bus&quot;&gt;&lt;/a&gt;注册和取消注册&lt;code&gt;Bus&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;EventBus&lt;/code&gt; 的注册过程，就是对接收某个事件的所有方法进行 &lt;code&gt;subscribe()&lt;/code&gt; ，在 &lt;code&gt;subscribe()&lt;/code&gt; 方法里拿到这些的方法，把这些方法存进 &lt;code&gt;subscriberMethods&lt;/code&gt;（一个 List 集合）中，然后把事件的类名作为 key ，把 &lt;code&gt;subscriberMethods&lt;/code&gt; 作为 value ，存进 &lt;code&gt;methodCache&lt;/code&gt;（一个 HashMap 缓存）里，这样就不用每次都去反射了。这里需要注意一点，&lt;code&gt;EventBus&lt;/code&gt; 里用 &lt;code&gt;methodCache&lt;/code&gt; cache 下来的不是 &lt;code&gt;Observer&lt;/code&gt; ，也不是 &lt;code&gt;Observable&lt;/code&gt; ，而是 &lt;code&gt;Observable.subscribe(Observer)&lt;/code&gt;，即 &lt;code&gt;Subscription&lt;/code&gt; ，那么如果用 &lt;code&gt;RxJava&lt;/code&gt; ，该怎么去实现这么个功能呢？在 RxJava 里有这样一个类 &lt;code&gt;CompositeSubscription&lt;/code&gt; ，对应的是一个存储着 &lt;code&gt;Subscription&lt;/code&gt; 的 &lt;code&gt;HashSet&lt;/code&gt;，因此我们只需要将接收事件的方法 add 进一个 &lt;code&gt;CompositeSubscription&lt;/code&gt; ，在生命周期结束的时候，再把 &lt;code&gt;CompositeSubscription&lt;/code&gt; 取消订阅即可。&lt;/p&gt;
&lt;p&gt;明确了上面的流程，对 RxJava 的封装就好办了。我们只需要获取 &lt;code&gt;Subscription&lt;/code&gt; 即可。注意，这里跟 &lt;code&gt;EventBus&lt;/code&gt; 是有区别的，&lt;code&gt;EventBus&lt;/code&gt; 的封装，是通过反射，获取所有接收事件的方法，然后注册，当然，现在的 &lt;code&gt;EventBus&lt;/code&gt; 版本里这些反射几乎对性能没有任何影响了。现在我们用 &lt;code&gt;RxJava&lt;/code&gt; 是不是也要用反射再去获取所有的 &lt;code&gt;Subscription&lt;/code&gt; 呢？当然不是，EventBus 的机制其实类似于广播，在接收事件的地方是没有方法调用的，因此需要反射。但是 &lt;code&gt;RxBus&lt;/code&gt; 则提供了调用接收事件的方法，因此只需要在 &lt;code&gt;Activity&lt;/code&gt; 或 &lt;code&gt;Fragment&lt;/code&gt; 里 new 出来 &lt;code&gt;CompositeSubscription&lt;/code&gt; 对象，然后在需要接收事件的地方，用 &lt;code&gt;CompositeSubscription&lt;/code&gt; 对象去 add 进对应的 &lt;code&gt;Subscription&lt;/code&gt; 就可以了(这一点在下面发送接收事件一节还会提到)。&lt;/p&gt;
&lt;p&gt;对应的取消注册的过程就简单多了，在生命周期结束的地方，对 &lt;code&gt;CompositeSubscription&lt;/code&gt; 取消注册即可，以避免内存泄露，而 &lt;code&gt;CompositeSubscription&lt;/code&gt; 的取消注册方法是可以自动取消 &lt;code&gt;HashSet&lt;/code&gt; 里的所有 &lt;code&gt;Subscription&lt;/code&gt; 的，因此无须对每个 &lt;code&gt;Subscription&lt;/code&gt; 单独处理。&lt;/p&gt;
&lt;h3 id=&quot;发送和接收事件&quot;&gt;&lt;a href=&quot;#发送和接收事件&quot; class=&quot;headerlink&quot; title=&quot;发送和接收事件&quot;&gt;&lt;/a&gt;发送和接收事件&lt;/h3&gt;&lt;p&gt;&lt;code&gt;EventBus&lt;/code&gt; 发送事件，就是 post 方法，在 &lt;code&gt;EventBus&lt;/code&gt; 里有一个内部类 &lt;code&gt;PostingThreadState&lt;/code&gt;， 通过 &lt;code&gt;postingState.eventQueue&lt;/code&gt; 可以获取一个 List 集合，只要 &lt;code&gt;eventQueue&lt;/code&gt; 不为空，就不断地从 &lt;code&gt;eventQueue&lt;/code&gt; 里取出事件（当然，伴随有是否为主线程，是否正在发送等状态的判断），然后调用 &lt;code&gt;postSingleEvent&lt;/code&gt; 方法，最后调 &lt;code&gt;postToSubscription&lt;/code&gt; 把事件发出去，post 一个，就从 &lt;code&gt;eventQueue&lt;/code&gt; 里 remove 一个，最终又来到了我们从刚接触 Android 就让人很头痛的 &lt;code&gt;Handler&lt;/code&gt; ，这是一个叫 &lt;code&gt;HandlerPoster&lt;/code&gt; 的类。说一千，道一万，对应的 &lt;code&gt;RxJava&lt;/code&gt; 处理事件就是调方法 &lt;code&gt;onNext&lt;/code&gt;。这样代码就有了。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object object)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    subject.onNext(object);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;EventBus&lt;/code&gt; 接收事件需要通过 &lt;code&gt;onEvent&lt;/code&gt; 开头的方法来遍历获取，第一次遍历会缓存，仅查找 &lt;code&gt;onEvent&lt;/code&gt; 开头的方法，同时忽略一些特定 SDK 的方法，可以提高一些效率。在使用 &lt;code&gt;RxJava&lt;/code&gt; 接收事件的时候，根据传递的事件类型(eventType)可以获取对应类型的 &lt;code&gt;Observable&amp;lt;EventType&amp;gt;&lt;/code&gt; ，那么问题就来了，在这里我们是不是要提供一个返回对应的 &lt;code&gt;Subscription&lt;/code&gt; 的方法呢？其实是可以的！但是需要指定 &lt;code&gt;Scheduler&lt;/code&gt; ，因为我们知道，接收事件处理事件是有可能在不同的线程里的，如果在这里我们就提供一个返回 &lt;code&gt;Subscription&lt;/code&gt; 的方法，那后续的事件处理是在哪个线程呢？因此在这里就指定了 UI 线程或者异步线程，后面的具体的事件处理就可能会有问题。当然，我们也只可以在需要接收事件的地方，调用 &lt;code&gt;toObservable&lt;/code&gt; 方法，然后指定线程。这也是相对于 &lt;code&gt;Otto&lt;/code&gt; 的一个优势。&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;RxBus&lt;/code&gt; 里：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Observable&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;toObservable&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Class&amp;lt;T&amp;gt; type)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; subject.ofType(type);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Subscription &lt;span class=&quot;title&quot;&gt;toSubscription&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;T&amp;gt; type, Action1&amp;lt;T&amp;gt; action1, Scheduler scheduler)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; RxBus.getInstance()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .toObservable(type)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .observeOn(scheduler)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .subscribe(action1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在 &lt;code&gt;Activity&lt;/code&gt; 或 &lt;code&gt;Fragment&lt;/code&gt; 里再去获取 &lt;code&gt;Subscription&lt;/code&gt; 。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Subscription &lt;span class=&quot;title&quot;&gt;toSubscription&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;T&amp;gt; type, Action1&amp;lt;T&amp;gt; action1)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; RxBus.getInstance()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .toObservable(type)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .observeOn(AndroidSchedulers.mainThread())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .subscribe(action1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最后，将所有的 &lt;code&gt;Subscription&lt;/code&gt; add 进 &lt;code&gt;CompositeSubscription&lt;/code&gt; 就好了。最后，一定不要忘记对 &lt;code&gt;CompositeSubscription&lt;/code&gt; 取消注册。&lt;/p&gt;
&lt;h2 id=&quot;StickyEvent的处理&quot;&gt;&lt;a href=&quot;#StickyEvent的处理&quot; class=&quot;headerlink&quot; title=&quot;StickyEvent的处理&quot;&gt;&lt;/a&gt;&lt;code&gt;StickyEvent&lt;/code&gt;的处理&lt;/h2&gt;&lt;p&gt;到这里，有关 &lt;code&gt;EventBus&lt;/code&gt; 的内容，基本是完了，不过还有一点，&lt;code&gt;EventBus&lt;/code&gt; 里是有一个 &lt;code&gt;StickyEvent&lt;/code&gt; 的，什么意思呢，就是说一般流程是，我们先去订阅事件，然后被观察者再去发布事件，观察者去接收事件，但是如果是先发布了事件，再去订阅事件呢？这时候先于订阅事件之前发布的事件就会被丢弃，这时候 &lt;code&gt;StickyEvent&lt;/code&gt; 就登场了。即便是先于订阅事件之前发布了事件，它已然可以接收一个最近被发布的事件，可以理解为它缓存了一个最近发布的事件，而与订阅状态无关。当然，只是一个！明确了这些，要用 &lt;code&gt;RxJava&lt;/code&gt; 实现就非常简单了，在 &lt;code&gt;RxJava&lt;/code&gt; 里有一个 &lt;code&gt;BehaviorSubject&lt;/code&gt; 完美实现了这个功能，具体实现跟 &lt;code&gt;PublishSubject&lt;/code&gt; 一模一样。这时候就会有人问了，如果我们想要接收到所有的（而不是一个）在订阅事件之前发布的事件，该怎么办呢？很遗憾，&lt;code&gt;EventBus&lt;/code&gt; 是无法办到的，但是 &lt;code&gt;RxJava&lt;/code&gt; 可以！将 &lt;code&gt;BehaviorSubject&lt;/code&gt; 换成 &lt;code&gt;RelaySubject&lt;/code&gt; 即可。不过说句题外话，这样的功能好鸡肋啊，感觉适用场景少之又少。我想这也是 &lt;code&gt;EventBus&lt;/code&gt; 没有去实现这样的功能的原因吧。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;具体使用可以参照&lt;a href=&quot;https://github.com/liangzhitao/AndroidFluxPractice&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AndroidFluxPractice&lt;/a&gt;，Sample 里将 EventBus 替换为了 RxBus ，完美地实现了一模一样的效果。&lt;/p&gt;
&lt;p&gt;参考：&lt;a href=&quot;http://www.jianshu.com/p/ca090f6e2fe2/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/ca090f6e2fe2/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h2&gt;&lt;p&gt;接触过 &lt;code&gt;EventBus&lt;/code&gt; 和 &lt;code&gt;RxJava&lt;/code&gt; 的都知道，可以用 &lt;code&gt;RxJava&lt;/code&gt; 来实现 &lt;code&gt;EventBus&lt;/code&gt;，网上随便一搜，就可以拿得到代码。但是究竟为什么可以这么做？却没有类似的文章作进一步的深度解析。（本文假定读者都已经了解 &lt;code&gt;EventBus&lt;/code&gt; 和 &lt;code&gt;RxJava&lt;/code&gt; 是什么，可以做什么。）
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="EventBus" scheme="http://www.easydone.cn/tags/EventBus/"/>
    
      <category term="RxJava" scheme="http://www.easydone.cn/tags/RxJava/"/>
    
  </entry>
  
  <entry>
    <title>给自己一个标杆</title>
    <link href="http://www.easydone.cn/2016/03/27/"/>
    <id>http://www.easydone.cn/2016/03/27/</id>
    <published>2016-03-27T14:10:26.000Z</published>
    <updated>2016-03-27T14:21:42.000Z</updated>
    
    <content type="html">&lt;blockquote&gt;
&lt;p&gt;我和我的朋友们一起在我们乡下的老家发起了一个图书馆项目，现在这个项目已经持续了三年多了。这是一篇约稿，答应同学要写写自己的经历，写的也比较随性，想到哪儿就写到哪儿。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;12年毕业之后，在一家郑州的公司，工资是2200块，扣了社保公积金，一个月到手的是1700块。因为在都市村庄住，安全性很差，又丢了钱，索性就找了个小区，房租是一个750，再加上吃饭要500块，一个月结余大概400块。房租是押一付三，第一次交房租要3000块，向同事借了2000块交了房租。也就是说，那时候连看电影，买水果都是不可想象的。因为工作的关系，要经常出差，但是只能出差回来再报销，差旅费我是向朋友借的。在我上班半年之后，欠人的钱终于还清了。跟同事的关系都处的很好，至少我感觉是这样。我在豆瓣上写下了这样的话：我希望整个职业生涯都在这里读过。然而，这时候，我被公司辞退了，至今没想通为什么。我可以毫不夸张的说，当时我的能力能秒部门里60%以上的人。&lt;/p&gt;
&lt;p&gt;然后，我又在郑州找了个工作，鉴于上份工作被辞退的经历，这份工作我做的更加努力，二月份入职，虽说是双休，但是整个三月份和四月份上半月，我一天都没休息，连着上了将近五十天的班，甚至还有几个通宵，领导很赏识我，说要给我涨500块的工资。我觉着我的付出得到了回报，我干活更加卖力。然而事与愿违，等到发工资的时候，发现并不是那么回事。我很委屈，于是我辞职了。我不想再呆在郑州了，我去了南京，到了南京几个月，天天催郑州这边的发工资，终于还是拿到工资了，虽然并没有拿到全部。我希望彻底翻过这一页，在南京重新开始。&lt;/p&gt;
&lt;p&gt;在南京，我去了软通做华为外包，经过上两份工作的经历，我已经对工作没有那么多期待，再也不会凭着一腔热情就把工作当做自己的全部。在南京的一年多时间里，我从没加过一次班。在此期间，无意中我得知了一个组织—GDG，通过GDG的介绍，我开始接触了 Android，感觉很有意思，至今仍记得南京的半坡村。因为再也没加过班，每天晚上六点之前一定会到家。就开始利用业余时间开始学习 Android 方面的东西，当然，当时并没有要把开发 Android 作为职业的想法。&lt;/p&gt;
&lt;p&gt;如果要问我工作开心吗？做一份外包工作，能有什么开心不开心的~但是真正让我下决心离开，是另外一件事。华为一张姓某女姓HR，肥的像猪一样，脸上还有一颗巨大无比的痣，是她，让我明白了一个道理：“长得丑陋的人，内心也很丑陋”。这个人的无耻，以及在郑州我自己遭受到的侮辱，成了每天晚上我在家里练习写代码到十二点以后的动力。在她第十次当着我们几个软通同事的面，用极其下作的手段和言辞歧视污蔑我们之后，我辞职了。去年十月份，我再次回到南京，那时候我的工资已经比在郑州时候涨了六倍，比在南京时候涨了三倍半，我当着张姓HR的同事的面，把她喷了一通。并不是说现在我工资多么高，不过只要比他们华为那些人高一点点我就满足了。&lt;/p&gt;
&lt;p&gt;来到北京之后，经历了半年多的9116，总算是熬出了一点成绩，个中滋味，我自己最清楚。我从来都不会把“那些无法击败你的挫折只会让你变得更强大”作为自己的签名，因为我一直都在用最不容置疑的行动去诠释它。这时候离我毕业刚好三年。“我等了三年，就是要等一个机会，我要争口气，不是想证明我了不起，而是要告诉别人我失去的东西，我一定要拿回来！”&lt;/p&gt;
&lt;p&gt;比起这些成绩，我更加庆幸，在经历这么多让自己一想起来，情绪就控制不住地变得暴戾起来的事情，自己的三观依然能够越来越正。感谢一直以来遇到的这么多的优秀的人，想要争口气的动力在从0到1的成长中会让人很受用，而从1到100的路，会有更多的荆棘，羡慕不崇拜不强求，向往憧憬优秀，又绝对的不卑不亢，摆正位置，努力做自己。这就是我的故事。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;我和我的朋友们一起在我们乡下的老家发起了一个图书馆项目，现在这个项目已经持续了三年多了。这是一篇约稿，答应同学要写写自己的经历，写的也比较随性，想到哪儿就写到哪儿。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://www.easydone.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="经历" scheme="http://www.easydone.cn/tags/%E7%BB%8F%E5%8E%86/"/>
    
  </entry>
  
  <entry>
    <title>记一次微信朋友圈逆向</title>
    <link href="http://www.easydone.cn/2016/02/27/"/>
    <id>http://www.easydone.cn/2016/02/27/</id>
    <published>2016-02-27T00:04:30.000Z</published>
    <updated>2016-03-07T01:06:04.000Z</updated>
    
    <content type="html">&lt;p&gt;最近入了一个 apk 逆向的坑，坑深似海，不过初步算是有了一些成果，记录一下先。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;###确定方案&lt;br&gt;刚开始想到两个方案：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;借助 Xposed ，有现成的插件可以获取数据，但是由于并无法获取朋友圈条目实体的字段，而是根据获取的部分自己去拼的实体，同时还要求 root ，armv7 的手机还不支持 Xposed 等，局限性有点大，就舍弃了该方案。在此感谢 &lt;a href=&quot;https://blog.chionlab.moe/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Chion Tang&lt;/a&gt; 同学，技术非常棒的一位大二学生，帮我提供了不少有用的信息。网上看到他的文章，然后还加了微信，又认识一位小伙伴，感觉很棒。&lt;/li&gt;
&lt;li&gt;通过查看微信的数据库缓存发现，微信的 Sqlite 里朋友圈这部分数据是没有加密的，于是就设想模拟滑动，然后不断从微信服务器拉取数据，然后缓存起来，再通过缓存取得数据。这种方案的局限显而易见，就是对于微信的存储方案并不了解，获取的数据完整性和可靠性不能保证，也就失去了其意义。&lt;/li&gt;
&lt;li&gt;在上面两种方式都遇到瓶颈的时候，我师傅小虎提供了一种思路： Android 里 Java 代码会被先编译为 smali 代码，于是就设想通过在获取服务端数据之后，显示在界面上之前，即 ListView 的 Adapter &lt;code&gt;notifyDataSetChanged&lt;/code&gt; 之前，插入我们想要执行的 smali 代码（比如获取 adapter 里 list 集合的变量，然后遍历集合，将数据存储在一个文件里，保存在 SD 卡），这样就可以获取朋友圈的数据。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最终选择了第三种方案。假如微信没有做服务端的一些验证的话，这种方式是有可能会获取完整可靠的数据的。当然，也有不少技术难点。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;找到 &lt;code&gt;notifyDataSetChanged&lt;/code&gt; 的代码位置；&lt;/li&gt;
&lt;li&gt;APK 解包，二次打包能否正常进行；&lt;/li&gt;
&lt;li&gt;smali 语法。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;###确定插入代码位置&lt;br&gt;要确定插入代码的位置，我使用了 &lt;code&gt;jadx&lt;/code&gt; 这个工具，对 apk 进行逆向，使用 &lt;code&gt;jadx-gui&lt;/code&gt; 查看被混淆过的 java 代码，由于 Activity 及其里面的方法名是无法被混淆的，很容易就找到了具体用户的朋友圈入口，&lt;code&gt;com.tencent.mm.plugin.sns.ui.SnsUserUI&lt;/code&gt; ，然后通过关键字搜索找到了 &lt;code&gt;notifyDataSetChanged&lt;/code&gt; 所在的位置。调用这个方法的是 &lt;code&gt;SnsUserUI&lt;/code&gt; 这个类里的 aBp()方法，继承自父类 SnsActivity。最终确定了混淆后的 Adapter 类名，实体类名，以及相关的一些变量名。&lt;/p&gt;
&lt;p&gt;###验证能否正常解包和二次打包&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;正常反编译的命令是 &lt;code&gt;apktool d -o weixin wx.apk&lt;/code&gt; -o 就是 output ，将 wx.apk 反编译后输出到当前目录下的 &lt;code&gt;weixin&lt;/code&gt; 目录里。但是使用这个参数在二次打包的时候，可能会因为资源文件无法加入构建而造成打包失败。因此在解包时需要忽略资源文件，&lt;code&gt;apktool d -f -r apkfilename.apk&lt;/code&gt; &lt;code&gt;-f&lt;/code&gt; 指替换之前反编译的 apk 里代码，&lt;code&gt;-r&lt;/code&gt; 表示在反编译的时候忽略资源文件，因此二次打包就不会再遇到上述问题。（参考：&lt;a href=&quot;http://stackoverflow.com/questions/23317208/apktool-build-apk-fails&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;apktool build apk fails&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;二次打包的命令为 &lt;code&gt;apktool b wx new.apk&lt;/code&gt; ，反编译后的输出目录为 wx ，二次打包就是将 &lt;code&gt;wx&lt;/code&gt; 目录二次打包为 new.apk ，new.apk 的输出目录为 &lt;code&gt;wx&lt;/code&gt; 目录下的 &lt;code&gt;dist&lt;/code&gt; 目录。可以添加 &lt;code&gt;-o&lt;/code&gt; 指令，设置另外的 apk 输出目录。&lt;/li&gt;
&lt;li&gt;使用 debugkey 对二次打包的 apk 进行签名 &lt;code&gt;jarsigner -keystore debug.keystore -storepass android -keypass android new.apk androiddebugkey&lt;/code&gt; ，然后安装。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;至此，进入了整个流程里最困难的一个环节。&lt;/p&gt;
&lt;p&gt;###插入 smali 代码&lt;br&gt;由于对 smali 语法的一无所知，同时 smali 代码的调试也是一个大问题。（&lt;strong&gt;在此，感谢 Trinea 4群的小伙伴们的帮助，群里当真是卧虎藏龙，帮我指出了不少 smali 语法上的错误。&lt;/strong&gt;）我先学习了一下语法，大致能看明白一部分的 smali 代码，然后在 smali 里 &lt;code&gt;notifyDataSetChanged&lt;/code&gt; 之前，插入了打印日志的代码，再打包执行，没有问题！但是因为真正要插入的保存数据的代码比较复杂，自己写暂时还不太现实，最后决定先写 demo ，将要插入的代码先在 demo 里写，然后再用 apktool 解包 apk，获取插入的那一段 smali 代码，再对其修改，然后插入到 SnsUserUI.smali 里。经过一番尝试，修改了已知的语法错误后，进入具体用户的朋友圈，微信仍然是闪退…&lt;/p&gt;
&lt;p&gt;接着尝试对 smali 代码进行 debug 调试，以查看具体哪部分报错，最终找到了 smalidea 这个 IDEA 插件，官方给的教程并不详细，经过一番摸索，总结了一下，教程大致如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;下载 zip 插件包，然后安装；&lt;/li&gt;
&lt;li&gt;下载 smali.jar 和 baksmali.jar，smali 和 baksmali 脚本，然后 chmod 添加执行权限，再然后配置环境变量；&lt;/li&gt;
&lt;li&gt;使用 smali 脚本解包 apk ；&lt;/li&gt;
&lt;li&gt;将解包后的目录导入到 Android Studio，然后配置 SourceRoot 目录，再配置 SDK 和 JDK，增加远程调试选项并设置调试端口；&lt;/li&gt;
&lt;li&gt;adb install 安装apk，然后打开 ddms ，开始调试。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最终在打开 USB 调试，选择调试应用的时候，然后发现 release 的应用都是不行的。因此只能启用 logcat 大法了。&lt;/p&gt;
&lt;p&gt;接下来只好一步步去排除可能会导致这样的结果的原因：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;然后尝试抓包，看是否有请求发送和响应，发现请求了，同时返回了200，再在无网环境下测试，依然会闪退。说明不是服务端校验的问题。至此就基本确定，是那段 smali 代码的问题。&lt;/li&gt;
&lt;li&gt;接着，我确定了另一个方向，先写一个往文件里写数据，再把文件保存在 SD 卡的方法（&lt;code&gt;writeDataToSdCard(String message)&lt;/code&gt;），然后去调这个方法，经过尝试发现 &lt;code&gt;writeDataToSdCard(&amp;quot;TESTTESTTESTTEST&amp;quot;)&lt;/code&gt; ，直接写字符串也是不行的（后来发现还是因为寄存器用的不对，最简单的一种解决方式就是方法名用 static 修饰）。&lt;/li&gt;
&lt;li&gt;此路不通，只好再用打印日志的方式，由于之前已经测试单纯地打印字符串日志是没问题的，这时候只要 for 循环 adapter 里的 list ，然后打印就可以了。当然，要先打印一条数据试试看这个 list 的获取是否正确，&lt;code&gt;Log.i(TAG, list.get(0).toString());&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;结果依然不行，logcat 里报了 &lt;code&gt;Verifier rejected&lt;/code&gt; &lt;code&gt;SnsUserUI is not the default one&lt;/code&gt; 的错误，目测是 Android 的一些验证失败了。所以这也并不能证明是获取的 list 的问题。&lt;/li&gt;
&lt;li&gt;接下来将 &lt;code&gt;forEach&lt;/code&gt; 循环换成了 &lt;code&gt;for(int i = 0; i &amp;lt; adapter.getCount(); i++)&lt;/code&gt; 的形式，然后打印输出 &lt;code&gt;adapter.getItem(i).toString()&lt;/code&gt; ，如此就避免了直接操作 list 的问题，因此就排除了4里提到的获取 list 错误的问题，但是结果在 logcat 里仍然出现了4中的错误。&lt;/li&gt;
&lt;li&gt;再次无路可走，这时候我师傅小虎又出马了，提醒我可以把5里面的 for 循环抽出来成静态方法，其实抽取方法以保证寄存器等不受影响，我在上面已经用过了，但是这时候思维已经钻进死胡同了，没有想到这一步。于是，按照师傅的指点，果然，大功告成了。还是插入的 smali 代码有问题，而且还发现之前找的 &lt;code&gt;notifyDataSetChanged&lt;/code&gt; 的入口是有问题的。&lt;/li&gt;
&lt;li&gt;最后就是从 Java 代码里找入口，确定字段的体力活了。不过，一眼看去，密密麻麻朋友圈实体里有几十上百个字段，还各种父类继承，Map，linkedList，一堆一堆的，这体力活真的好大…&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;至此，大致过程就 OK 了。顺带提一句，掌握一些基本的 shell，awk，sed 等终端语法命令还是很有必要的，会省下不少的繁复的工作量。当然，这也只是我自己执行的过程，别人做的时候，很可能会避开一些没有必要的坑。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近入了一个 apk 逆向的坑，坑深似海，不过初步算是有了一些成果，记录一下先。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="APK逆向" scheme="http://www.easydone.cn/tags/APK%E9%80%86%E5%90%91/"/>
    
      <category term="apktool" scheme="http://www.easydone.cn/tags/apktool/"/>
    
      <category term="smali" scheme="http://www.easydone.cn/tags/smali/"/>
    
  </entry>
  
  <entry>
    <title>国内的安卓(Android)生态环境是否变得愈加恶劣了</title>
    <link href="http://www.easydone.cn/2016/02/13/"/>
    <id>http://www.easydone.cn/2016/02/13/</id>
    <published>2016-02-13T01:17:02.000Z</published>
    <updated>2016-02-13T01:32:56.000Z</updated>
    
    <content type="html">&lt;p&gt;Android 的碎片化问题，这确实是个让人很沮丧的问题，无论是给开发者还是用户都带来了很多不必要的麻烦，这个确实没得洗。不过我们可以看到一些让人欣慰的地方，经过市场大浪淘沙，国内小米，华为，应用宝，360，魅族，锤子等（百度除外）各大厂商的应用市场都有自己的一套审核机制，上架过应用的开发者都应该清楚，有时候一些国内应用市场的审核会比 Google Play 更加严格。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;强烈建议个人用户不要对手机进行 root ，甚至不要开启 USB 调试模式和开发人员选项。事实上在拥有很好口碑的酷安网做了一个很不好示范，盗版破解暂且不说，很多 APP 爱好者 自以为很了解 Android（但也仅仅停留在自以为的程度），就对手机各种折腾，这是一个很不好的习惯。&lt;/p&gt;
&lt;p&gt;另外，各厂商对 Android 原生的适配，其实很大程度上这个锅不该由厂商来背的，Android 版本的更新不仅要靠 Google 和各大厂商，这是整个 &lt;strong&gt;开放手持设备联盟（Open Handset Alliance）&lt;/strong&gt; 共同的责任。Google 可以开放了源代码就撒手开发下一个版本，而对于不同硬件的适配，需要开放手持设备联盟共同完成。高通卡一下，博通卡一下，美满卡一下…整个进度就会慢下来。而且，一些本土化的定制，每个版本的升级可能都要做调整。还有一些原生不具备的一些功能，例如 MIUI 在4.X时代就提供了详细的权限控制和更优秀的功耗控制，这都是不可抹杀的功劳。&lt;/p&gt;
&lt;p&gt;当然，你锤不给 T1 升级5.0，真没法洗。&lt;/p&gt;
&lt;p&gt;至于系统开放性导致的流氓应用，这个我觉着是误解了。事实上，流氓应用并不是因为系统开放，而是因为平台系统的不完善。在 Android 6.0 之后，系统本身提供了更加完善的权限和唤醒机制，将会显著改善这一状况。&lt;/p&gt;
&lt;p&gt;至于 UI 风格，有不少人都在针对到底是抽屉导航（顶部导航）还是底部导航大谈特谈，我觉着 Android 是一个很开放的平台，Google 也是一个崇尚自有文化的公司，底部导航就是比其他的导航方式更优秀，追求优秀的东西又有什么错呢？当然，Android UI 现在主要就指 Material Design ，还有 &lt;code&gt;ripple&lt;/code&gt;，&lt;code&gt;card&lt;/code&gt;，&lt;code&gt;elevation&lt;/code&gt;，&lt;code&gt;shadow&lt;/code&gt;，&lt;code&gt;animator&lt;/code&gt; 等各种效果，但是仅仅 Material Design 是好设计，而其他的设计都不是好设计吗？&lt;a href=&quot;https://github.com/CosmicMind/Material&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Google’s Material Design and Apple’s Flat UI in Swift&lt;/a&gt;. iOS 可以接受其他的优秀设计，Android 就不可以吗？&lt;/p&gt;
&lt;p&gt;国内大公司的应用就一定是卡慢丑？不一定吧。事实上，一些大公司的应用，如微信，美团，滴滴，虾米音乐，Android 版本的体验并不输 iOS ，而大公司的开发人员们对应用本身的优化绝大多数都不是用户从 UI 上可以看到的。比如 &lt;code&gt;multiwebview&lt;/code&gt; 让用户可以在看公众号文章的时候，切到后台去聊天；再比如对 webp 格式图片的应用；还有 webview 对 pac 代理的支持；&lt;code&gt;hotfix&lt;/code&gt; 从 &lt;code&gt;dalvik&lt;/code&gt; 到 &lt;code&gt;art&lt;/code&gt; 的演变…这都是在 5.x 版本的之后 Android 里才有的。所以，5.x 可不是只有 &lt;code&gt;Material Design&lt;/code&gt; 哟。&lt;/p&gt;
&lt;p&gt;真正的深入了解之后，会发现手机厂商和大公司们也都在为 Android 的更好发展做着努力，虽然只是为了让自己活得更好的副产物，虽然也有非常多的让人不满意甚至讨厌的事情。作为开发者，我们要做的应该是不断去提升自己的能力，为了做出更优秀，让自己更加满意的应用而努力。iOS 设计稿确实很烦，但是除了这个，我们可以做的，能够显著改善用户体验的地方还很多。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Android 的碎片化问题，这确实是个让人很沮丧的问题，无论是给开发者还是用户都带来了很多不必要的麻烦，这个确实没得洗。不过我们可以看到一些让人欣慰的地方，经过市场大浪淘沙，国内小米，华为，应用宝，360，魅族，锤子等（百度除外）各大厂商的应用市场都有自己的一套审核机制，上架过应用的开发者都应该清楚，有时候一些国内应用市场的审核会比 Google Play 更加严格。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.easydone.cn/tags/Android/"/>
    
      <category term="智能手机" scheme="http://www.easydone.cn/tags/%E6%99%BA%E8%83%BD%E6%89%8B%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>TabLayout修改字体的方法</title>
    <link href="http://www.easydone.cn/2016/02/11/"/>
    <id>http://www.easydone.cn/2016/02/11/</id>
    <published>2016-02-11T03:54:26.000Z</published>
    <updated>2016-02-11T04:01:02.000Z</updated>
    
    <content type="html">&lt;p&gt;官方的 TabLayout 没有提供修改 TextView size 的方法，可以新建一个 style CustomTabLayoutTextAppearance 继承 &lt;code&gt;TextAppearance.AppCompat.Widget.ActionBar.Title.Inverse&lt;/code&gt; ，然后增加 item ，设置 &lt;code&gt;android:textAllCaps&lt;/code&gt; 为 true ，再设置 android:textSize 为你想设置的大小。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/TabLayout-style.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;再在 TabLayout 的布局文件里设置 &lt;code&gt;app:tabTextAppearance=&amp;quot;@style/CustomTabLayoutTextAppearance&amp;quot;&lt;/code&gt; 即可。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/Tablayout-layout.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;官方的 TabLayout 没有提供修改 TextView size 的方法，可以新建一个 style CustomTabLayoutTextAppearance 继承 &lt;code&gt;TextAppearance.AppCompat.Widget.ActionBar.Title.Inverse&lt;/code&gt; ，然后增加 item ，设置 &lt;code&gt;android:textAllCaps&lt;/code&gt; 为 true ，再设置 android:textSize 为你想设置的大小。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.easydone.cn/tags/Android/"/>
    
      <category term="Tablayout" scheme="http://www.easydone.cn/tags/Tablayout/"/>
    
  </entry>
  
  <entry>
    <title>一月</title>
    <link href="http://www.easydone.cn/2016/02/02/"/>
    <id>http://www.easydone.cn/2016/02/02/</id>
    <published>2016-02-02T04:06:22.000Z</published>
    <updated>2016-02-02T05:32:03.000Z</updated>
    
    <content type="html">&lt;p&gt;2016年的1月1号上了最后一天班之后，我就辞职了，手续什么的办理的也都很顺利。一切都在按计划进行，结束了长久以来自己都不甚满意的工作，感觉蛮好的。尚未辞职之前，接下来的整个1月，都已经被自己的计划给排的满满当当，比较幸运的是，在自由的1月里，基本算是完成了自己的计划。过年这段时间，可以针对一些还不是很完善的地方，做一些具体的补充。总之，还是蛮充实的。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;花了大概两周时间，确定了新工作，年后入职，当然，找工作这段时间里，也有不少闲暇的等待时间。去凯哥家里蹭了顿饭，凯哥亲自炖的排骨，炒的西红柿鸡蛋，还跟凯哥在优衣库前面自拍了一发。重新学习了一下 RxJava 的操作符，工作流程什么的，又学习了 Realm ，Retrofit2，OkHttp3 的 API ，遇到了一些小困难，写了一些小 demo ，不过还好基本也都能解决，当然，还是要继续加深理解，路还很长。期间还不间断地帮原公司的项目做一些小修小补。&lt;/p&gt;
&lt;p&gt;工作确定了之后，原公司刚招的一位 Android 开发离职了，于是又回去顶了一周，基本确立了技术选型，把整个框架搭了起来，也写了几个页面。把代码从 SVN 迁移到了 BitBucket ，又因为各种各样的原因，又从 BitBucket 迁到了 Coding.net ，有一句说一句，相对 BitBucket ，Coding 的代码托管还是不错的。做了一周之后，实在是做不下去了，再加上真的有点打乱自己之前的计划了，就又回家休息了。在家里又继续维护了一段时间老项目，这老项目值得吐槽的地方太多了，当时我的想法就是赶紧弄完，以后跟这东西彻底撇清关系，以后再也不要再找我。直到昨天晚上，才算是真正彻底没了任何关系（也许）。&lt;/p&gt;
&lt;p&gt;接着，又跟 Maxiee 同学面基了两次，Maxiee 马上要研究生毕业了，现在在中关村优酷土豆，第一次就是在中关村，再次回到中关村，还是感慨良多，第二次在 MDAY 上，在 MDAY 上还见到了 andyiac , 咕咚和鲍老爷，鲍老爷带的妹子很好看。那天实在是太冷，结束后也就没多聊，跟 Maxiee 一起吃了个饭，就各回各家各找各妈了。&lt;/p&gt;
&lt;p&gt;再接着几天就一直在家，翻译了几篇文章，校对了几篇别人的翻译。学习了一下 Google 的 Databinding ，配合 Realm ，RxJava 写了一些代码，对 Realm 了解又多了一些，感觉 Realm 有可能真的能一定程度上完全替代 Sqlite ，当然，MVVM 现在在 Android 里还很不完善，而且一些小的 sample ，其实并不能感受到多少优势，反而由于 IDE 的提示功能不完善，很多东西只能靠背，写起来好烦。希望这种尴尬在16年能有比较大的改善吧。&lt;/p&gt;
&lt;p&gt;然后，去参加了 OPEN 的年会，见到了他们的 Android 开发 Yat3s，很有意思一个小孩儿，很棒的一个 party ，可惜基本上我睡也不认识，搞得略显尴尬。遇到一哥们儿，又跟他聊了半天 .net ，ASP 和数据库，一个 party 就这么度过了…过了一会儿，他跟一个漂亮妹子一起走了，我一直以为他也是一个人呢…再接着遇到一位 CSDN 的人，整个过程搞得自己很生气。总结一句话就是：狗眼看人低。后来我在朋友圈喷了 CSDN ，非常有必要在博客里再发一次，因为我真的很生气，毕竟被伤过：以前黑过不少次某 DN （其实不算黑，只是讲出了一些事实），今天遇上一个某 DN 大忽悠，更加坚定了我对某 DN 的看法，沽名钓誉，哗众取宠，简直业界毒瘤。不必说某 DN 博客系统烂到多么令人发指，也不必说论坛早已彻底堕落却毫无补救措施，就单单是动不动搞个大会高价卖票圈钱造星，制造虚假繁荣，就该把它钉在开发界耻辱柱上。&lt;/p&gt;
&lt;p&gt;紧接着，就开始写 MVP + Clean Architecture 了，这个算是最头疼，MVP + Clean Architecture ，看上去很美好，其实尔尔，至少是我个人是这种感觉，现在最大的感受就是 MVP 被神话了，天天都看到无数的 MVP 的 sample 和文章，都在吹嘘多么多么好，实际体验下来，真正提高的效率，从我个人来讲，是完全没感受到，当然，自己也只是很粗浅的一些理解，还需要更深入地去学习。当然，MVP 到 Clean Architecture 的距离就很近了，把非 View 层抽离成为 library 就可以了。本来是准备弃坑的，可是一想到，别人都在用，如果自己轻易就放弃了，在一些场合，岂不是很没面子，就又硬着头皮写了一些 MVP 的代码，虽然暂时还是没感受到 MVP 的好处。这一块儿算是接下来学习的一个重点了。&lt;/p&gt;
&lt;p&gt;前两天去看了电影《功夫熊猫》，很棒的动画片，我给满分。&lt;/p&gt;
&lt;p&gt;另外，这个月很多时间都是自己做饭，厨艺也长进了一点。&lt;/p&gt;
&lt;p&gt;总结下来，这个月虽然没上班，总算是也没被荒废掉，最大的收获就是写了不少代码，都是自己以前比较薄弱的知识点，然后就是彻底跟自己不喜欢的工作说拜拜了。这也算是这一年一个美好的开始吧。希望这一年都像这个月一样。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;2016年的1月1号上了最后一天班之后，我就辞职了，手续什么的办理的也都很顺利。一切都在按计划进行，结束了长久以来自己都不甚满意的工作，感觉蛮好的。尚未辞职之前，接下来的整个1月，都已经被自己的计划给排的满满当当，比较幸运的是，在自由的1月里，基本算是完成了自己的计划。过年这段时间，可以针对一些还不是很完善的地方，做一些具体的补充。总之，还是蛮充实的。
    
    </summary>
    
      <category term="随笔" scheme="http://www.easydone.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="http://www.easydone.cn/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>Add a TextView above a FloatingActionButton</title>
    <link href="http://www.easydone.cn/2015/12/18/"/>
    <id>http://www.easydone.cn/2015/12/18/</id>
    <published>2015-12-18T07:31:05.000Z</published>
    <updated>2015-12-18T10:33:19.000Z</updated>
    
    <content type="html">&lt;p&gt;今天在微博上看到&lt;a href=&quot;http://weibo.com/MrWrong12138&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Mr_Wrong丶&lt;/a&gt;同学提了个&lt;a href=&quot;http://weibo.com/2790907881/D8YLrrknq?from=page_1005052790907881_profile&amp;amp;wvr=6&amp;amp;mod=weibotime&amp;amp;type=comment&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;问题&lt;/a&gt;，问题指向了这里&lt;a href=&quot;http://stackoverflow.com/questions/33953223/how-to-add-a-textview-above-a-floatingactionbutton-in-android&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;How to add a TextView above a FloatingActionButton in Android&lt;/a&gt; 。问题描述看下图，大致来说就是 &lt;code&gt;FloatingActionButton&lt;/code&gt; 遮住了本该显示在上层的 &lt;code&gt;TextView&lt;/code&gt; 。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/TextViewAboveFABProblem.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;下面有人给了解决方案，给 &lt;code&gt;TextView&lt;/code&gt; 添加属性 &lt;code&gt;android:elevation=&amp;quot;7dp&amp;quot;&lt;/code&gt; ，乍一看，哇，好神奇，一个属性就完美解决了整个问题。那到底是为什么呢？（注意，&lt;code&gt;Elevation&lt;/code&gt; 只能用在 API19 以上。）&lt;/p&gt;
&lt;p&gt;仅仅是添加了 &lt;code&gt;elevation&lt;/code&gt; 属性就 OK 了，要整明白为什么，就得先去看看 &lt;a href=&quot;http://developer.android.com/reference/android/support/design/widget/FloatingActionButton.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;API&lt;/a&gt; 里这个 &lt;code&gt;elevation&lt;/code&gt; 到底是什么意思。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/FAB_elevation_des.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;大致就是说 &lt;code&gt;elevation&lt;/code&gt; 是 view 在 Z 轴上的位置，可以用一个浮点数加长度的单位来表示，一般情况下应该是 dp（这里的 sp 个人觉着应该是不对的）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在处理这个之前，首先我们需要了解一个概念，组件在 Z 轴上的高度等于 &lt;code&gt;translationZ + elevation&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;首先，我们看这个问题，TextView 被 &lt;code&gt;FloatingActionButton&lt;/code&gt; 覆盖了。这只说明一个问题：FloatingActionButton 一定是在 Z 轴上有默认的高度的，因为是同是 Z 轴的值，只有当 FloatingActionButton 在 Z 轴的高度大于 TextView 在 Z 轴的高度时，TextView 才会出现 TextView 被覆盖的情况。而在帧布局里后添加的组件会覆盖在先添加的组件上，如果 TextView 和 FloatingActionButton 在 Z 轴上的位置一样的话，TextView 就会显示在 FloatingActionButton 上了。这样我们就可以先打印出 &lt;code&gt;translationZ&lt;/code&gt; 和 &lt;code&gt;elevation&lt;/code&gt; 的默认值。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; elevation = fab.getElevation();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Toast.makeText(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, elevation + &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; fabTranslationZ = fab.getTranslationZ();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Toast.makeText(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, fabTranslationZ + &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我用的测试机是小米2sc，得到的 &lt;code&gt;elevation&lt;/code&gt; 值是 12.0 ，&lt;code&gt;fabTranslationZ&lt;/code&gt; 的值是 0.0 。因为手机分辨率是 720P，所以这个 &lt;code&gt;elevation&lt;/code&gt; 默认值就是 6dp ，&lt;code&gt;fabTranslationZ&lt;/code&gt; 默认值是 0dp 。&lt;/p&gt;
&lt;p&gt;那样，这样是不是就彻底解决我们的问题了呢？答案是：否！以内即便设置了 &lt;code&gt;android:elevation=&amp;quot;6dp&amp;quot;&lt;/code&gt;，正常显示 &lt;code&gt;TextView&lt;/code&gt; 不会被覆盖，但是当我们点击按压 &lt;code&gt;FloatingActionButton&lt;/code&gt; 的时候，ripple 散开，这个 &lt;code&gt;TextView&lt;/code&gt; 还是会覆盖掉。所以说这样处理并不完美。因为是点击按压的时候出现了问题，那我们就再看 &lt;code&gt;FloatingActionButton&lt;/code&gt; 是否有相关的属性，刚好就有一个 &lt;code&gt;app:pressedTranslationZ&lt;/code&gt; 属性，而它也是有默认值的，当我们把它的值设置为 0dp 时，就完美解决了按压时被覆盖的问题。&lt;/p&gt;
&lt;p&gt;既然明确了上面的结论，那接下来处理就非常简单了。终极的解决方案就是：设置 &lt;code&gt;FloatingActionButton&lt;/code&gt; 的默认阴影为 0dp ，&lt;code&gt;app:elevation=&amp;quot;0dp&amp;quot;&lt;/code&gt;；因为 &lt;code&gt;fabTranslationZ&lt;/code&gt; 默认值是 0dp ，所以不用管；然后设置 &lt;code&gt;app:pressedTranslationZ&lt;/code&gt; 的值为 0dp ，&lt;code&gt;app:pressedTranslationZ=&amp;quot;0dp&amp;quot;&lt;/code&gt; ，来保证按压时 TextView 不被覆盖。（这样做牺牲了好多其他的效果，还是不完美…）&lt;/p&gt;
&lt;p&gt;最后我们来看一看关于 &lt;code&gt;FloatingActionButton&lt;/code&gt; 的默认值 &lt;a href=&quot;https://android.googlesource.com/platform/frameworks/support.git/+/master/design/res/values/dimens.xml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;dimens.xml&lt;/code&gt;&lt;/a&gt; ，验证一下我们的设置。当然还要感谢&lt;a href=&quot;http://weibo.com/MrWrong12138&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Mr_Wrong丶&lt;/a&gt;同学帮我一起来验证解决问题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/FabDefaultSize.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天在微博上看到&lt;a href=&quot;http://weibo.com/MrWrong12138&quot;&gt;Mr_Wrong丶&lt;/a&gt;同学提了个&lt;a href=&quot;http://weibo.com/2790907881/D8YLrrknq?from=page_1005052790907881_profile&amp;amp;wvr=6&amp;amp;mod=weibotime&amp;amp;type=comment&quot;&gt;问题&lt;/a&gt;，问题指向了这里&lt;a href=&quot;http://stackoverflow.com/questions/33953223/how-to-add-a-textview-above-a-floatingactionbutton-in-android&quot;&gt;How to add a TextView above a FloatingActionButton in Android&lt;/a&gt; 。问题描述看下图，大致来说就是 &lt;code&gt;FloatingActionButton&lt;/code&gt; 遮住了本该显示在上层的 &lt;code&gt;TextView&lt;/code&gt; 。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="Elevation" scheme="http://www.easydone.cn/tags/Elevation/"/>
    
      <category term="FloatingActionButton" scheme="http://www.easydone.cn/tags/FloatingActionButton/"/>
    
  </entry>
  
  <entry>
    <title>fuck-2015-flirt-2016</title>
    <link href="http://www.easydone.cn/2015/12/14/"/>
    <id>http://www.easydone.cn/2015/12/14/</id>
    <published>2015-12-14T07:38:44.000Z</published>
    <updated>2015-12-15T02:49:36.000Z</updated>
    
    <content type="html">&lt;p&gt;晃晃悠悠居然又一年了。&lt;/p&gt;
&lt;p&gt;回头来看，这一年居然做了这么多事。很多事情越来越看不清楚，越来越感受到生活的无奈和复杂。这一年，得到了很多，也失去了很多，时间就在这得失往复中一点点流逝了。创业这一年，身边的小伙伴聚散合离，旧的项目倒下去，新的项目立起来，看着其他友商完全在重复着一模一样的节奏，心里五味杂陈，尤其是这下半年，形势越来越差，Winter is coming ，仿佛一夜之间，所有人都被北京这个寒冬突然击中。这种事情尤其不能回顾，否则只会让本就已经身心俱疲的创业者更加沮丧。当把个人经历与时代变迁结合起来，往往能让自己对自己的遭遇多一分无比认同的同情。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;而我只想说两个字：累了。所以我在寻求改变。&lt;/p&gt;
&lt;p&gt;相对于传统行业，互联网还是太弱小，太浮躁了，无论是顺风前行还是逆风而上，都太缺乏耐心和踏实。不管是做产品还是做技术，我们都太需要沉下心来，走好每一步了。有些所谓的互联网从业人员，对传统行业的前辈们实在是缺乏尊重，自己尚且只是一小兵蛋子，也只是在自己所在的领域有一点点成绩，就敢肆无忌惮地对比自己绝大多数方面都优秀的前辈们指手画脚，年轻人的意气风发不是这么玩的，做人做事不保持一颗敬畏之心，即使有了一定成就也只是运气好而已。换个角度讲，尊重都是相互的。传统行业面对互联网从业人员的傲慢与偏见，似乎更加常见，而且体现在各个阶层，甚至是方方面面。他们渴望拥有新兴行业的活力与朝气，又放不下身段去向自认为的晚辈去学习，总是一副居高临下的姿态，俨然一傲娇的土包子。我的建议，21世纪的人不要与北京人元谋人有过多的交集。&lt;/p&gt;
&lt;p&gt;从个人的职业规划来讲，这一年技术的提升算是唯一值得安慰的事情，然而提升却也很有限。我太清楚自己的缺点了，并不是要给自己成长过程中的漏洞找什么理由，然而事实确实如此。由于创业项目的盲目不理性，整个团队的人花了太多的时间去做重复性的事情，而在真正需要提高自己的方面，却因为没有多余的时间去钻研，而在一直原地踏步，甚至一些东西由于长时间没再去了解，几乎已经完全丢弃了。其实说白了，就是自己做什么东西都浮于表面，更深层次的逻辑和原理并不清楚，或者是了解的很少。做学问，做技术最忌讳这种半桶水，然而我却在这条道路上越走越远。再加上有时候怎么都甩不掉的惰性和盲目，想想都觉着可怕。希望接下来的日子里，自己能够更加踏实地走好每一步，把自己渴望了解的每一个技术细节都完完全全搞透彻，真正沉下心来，这是一个说易行难的事情，又是每一个有追求，有思想的人必须要具备的素质。&lt;/p&gt;
&lt;p&gt;这一年，要感谢的人太多，虽说这一年成长有限，然而总归还是有一些进步的。虽然周围的小伙伴换了一拨又一拨，然而核心团队三人组虽不能生死相依，却也能始终不离不弃，该到了说再见的时候，还是会有些许伤感。社区的小伙伴也实在太给力，这一年认识了很多乐于分享创造，乐于推动 Android 在中国发展的利己又利人的小伙伴，没有他们的帮助和支持，自己面对前进道路上数不清的荆棘和雾霾，可能早已选择放弃。每一位乐于分享的朋友，在帮助别人的同时，也在接受着别人的帮助，很开心能有这样良性的氛围，这对自己，对整个大环境里的每一个人都会是最美好，也越来越美好的时代。&lt;/p&gt;
&lt;p&gt;最近一直在面试，这就是我选择的寻求改变的方式，结果不是很让自己满意，不过也都还说得过去，感触还是蛮多的。我的感受是，偏传统行业里的企业，行业里江河日下的企业，往往最是傲慢，去这种企业面试，完全是浪费自己的时间。把完善自己职业生涯的希望都寄托于运气，幻想能遇到传统企业里的一个敢于创新，冲破传统思维和偏见束缚的机会，这是对自己的不负责任。而自己对结果的不满意也全部都来自这样的企业。当然，大部分的面试过程都还是很棒的，虽然结果可能不是自己想要的。最惊喜的是参加的高德的面试，虽然没有通过，收获却很大。整个面试过程只有一个问题，而面试官几乎要算是我遇到过的最 Nice 的面试官了（我想到了一个词：人格的魅力…），对我的职业生涯提了不少很中肯可行的建议。跟传说中的阿里文化完全不一样，当然，也只有这样认真负责的技术人才能成就如此伟大的企业。(PS：面试官貌似是台湾人，都是把软件叫做软体的。)现在自己最切实的感受就是：找工作一定要慎重！找工作一定要慎重！找工作一定要慎重！重要的事情说三遍。这是对自己负责的表现，哪怕会花上很长的时间，这都是值得的。&lt;/p&gt;
&lt;p&gt;现在再去看《fuck-2014-flirt-2015》，惊喜的发现，自己当初定下的目标居然全都完成了。最奇妙的是自己居然真的领了结婚证了，相互扶持，相濡以沫的岁月，以前是，现在是，以后还会是。这真是一个要人每一分每一秒都想要去感恩的一年。下一年，会是怎样的一个让人期待的光景？&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;晃晃悠悠居然又一年了。&lt;/p&gt;
&lt;p&gt;回头来看，这一年居然做了这么多事。很多事情越来越看不清楚，越来越感受到生活的无奈和复杂。这一年，得到了很多，也失去了很多，时间就在这得失往复中一点点流逝了。创业这一年，身边的小伙伴聚散合离，旧的项目倒下去，新的项目立起来，看着其他友商完全在重复着一模一样的节奏，心里五味杂陈，尤其是这下半年，形势越来越差，Winter is coming ，仿佛一夜之间，所有人都被北京这个寒冬突然击中。这种事情尤其不能回顾，否则只会让本就已经身心俱疲的创业者更加沮丧。当把个人经历与时代变迁结合起来，往往能让自己对自己的遭遇多一分无比认同的同情。
    
    </summary>
    
      <category term="随笔" scheme="http://www.easydone.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="总结" scheme="http://www.easydone.cn/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>面试题第一波－GrowingIO</title>
    <link href="http://www.easydone.cn/2015/11/25/"/>
    <id>http://www.easydone.cn/2015/11/25/</id>
    <published>2015-11-25T13:32:08.000Z</published>
    <updated>2015-12-15T02:24:04.000Z</updated>
    
    <content type="html">&lt;p&gt;从今天开始，正式开启了漫漫的面试之路。感谢简寻，一家非常靠谱的招聘网站，推荐的公司也都像简寻一样 nice 。今天要说的就是面试的第一站－GrowingIO ，一家做数据挖掘的公司。面我的面试官技术非常厉害，提的问题大部分也都很有深度，根据问题和我的回答，大致总结一下，希望能对大家有所帮助。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Android APP 优化一般都涉及哪些方面？&lt;/li&gt;
&lt;li&gt;自定义控件里，如果出现了锯齿，是为什么？该怎么处理？&lt;/li&gt;
&lt;li&gt;Glide 是如何设计的？相比 Picasso 有哪些优点和不足？Fresco 有什么特点？&lt;/li&gt;
&lt;li&gt;MVP ，MVVM ；&lt;/li&gt;
&lt;li&gt;onDraw 方法怎么去画一个图形？&lt;/li&gt;
&lt;li&gt;Activity 为什么有那么多生命周期？&lt;/li&gt;
&lt;li&gt;纵横屏切换怎么处理？&lt;/li&gt;
&lt;li&gt;加密算法有哪几种？MD5 有什么特点？&lt;/li&gt;
&lt;li&gt;算法和数据结构一笔带过；&lt;/li&gt;
&lt;li&gt;RPC 工作原理；&lt;/li&gt;
&lt;li&gt;Handler , AsyncTask 工作原理，怎么处理内存泄漏？&lt;/li&gt;
&lt;li&gt;RxJava 相关；&lt;/li&gt;
&lt;li&gt;GreenDAO 和 ORMLite 实现方式有什么不同，GreenDAO 的升级和存取；&lt;/li&gt;
&lt;li&gt;Socket （自己也就随便扯了点 WebSocket 的东西）通信同样一笔带过…&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;大致就这么多问题，由于有比较大一部分问题，我所了解的都基本上等于0，所以面试官就都一笔带过了。题目涉及面还是比较广的，对我来说，还很深啊…有不少问题，一听就是一脸黑线，茫然不知所措…当然，自己也现场请教了不少问题，收获还是蛮大的。&lt;/p&gt;
&lt;p&gt;总之，这是一家非常棒的公司，不过最终由于时间上的关系，恐怕去不了了。有兴趣的小伙伴，可以去看看，绝对不会后悔的。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;从今天开始，正式开启了漫漫的面试之路。感谢简寻，一家非常靠谱的招聘网站，推荐的公司也都像简寻一样 nice 。今天要说的就是面试的第一站－GrowingIO ，一家做数据挖掘的公司。面我的面试官技术非常厉害，提的问题大部分也都很有深度，根据问题和我的回答，大致总结一下，希望能对大家有所帮助。
    
    </summary>
    
      <category term="工作" scheme="http://www.easydone.cn/categories/%E5%B7%A5%E4%BD%9C/"/>
    
    
      <category term="面试" scheme="http://www.easydone.cn/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>greenDAO的升级和存取</title>
    <link href="http://www.easydone.cn/2015/11/13/"/>
    <id>http://www.easydone.cn/2015/11/13/</id>
    <published>2015-11-13T02:32:51.000Z</published>
    <updated>2015-12-15T02:24:13.000Z</updated>
    
    <content type="html">&lt;p&gt;greenDAO 这么牛逼的库，很多人因为一些误解而放弃使用它，真的很可惜，同时也确实，有很多博客都在介绍 greenDAO 的使用，但是不得不说一些风气很不好，基本上都是官方文档上的 sample 自己照着抄一遍，然后就成文发布了，最让人困惑的一些问题一个都没涉及到。我大致总结了一下，不少人遇到的无非两个问题，升级和带 List 的 Object 的存取，算是记录一下。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;数据库升级&quot;&gt;&lt;a href=&quot;#数据库升级&quot; class=&quot;headerlink&quot; title=&quot;数据库升级&quot;&gt;&lt;/a&gt;数据库升级&lt;/h2&gt;&lt;p&gt;有不少同学不选择 &lt;strong&gt;&lt;em&gt;greenDAO&lt;/em&gt;&lt;/strong&gt; 都是说它升级不好办，其实很简单。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;创建 &lt;strong&gt;&lt;em&gt;THDevOpenHelper&lt;/em&gt;&lt;/strong&gt; 继承 &lt;strong&gt;&lt;em&gt;DaoMaster.OpenHelper&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Created by Android Studio&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * User: Ailurus(ailurus&lt;span class=&quot;doctag&quot;&gt;@foxmail&lt;/span&gt;.com)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Date: 2015-07-08&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Time: 11:29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;THDevOpenHelper&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DaoMaster&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;OpenHelper&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;THDevOpenHelper&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context, String name, SQLiteDatabase.CursorFactory factory)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(context, name, factory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onUpgrade&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(SQLiteDatabase db, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; oldVersion, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; newVersion)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (oldVersion) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Log.i(&lt;span class=&quot;string&quot;&gt;&quot;greenDAO&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Upgrading schema from version &quot;&lt;/span&gt; + oldVersion + &lt;span class=&quot;string&quot;&gt;&quot; to &quot;&lt;/span&gt; + newVersion);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在 &lt;strong&gt;&lt;em&gt;Application&lt;/em&gt;&lt;/strong&gt;里初始化&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseApplication&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Application&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; DaoMaster daoMaster;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; DaoSession daoSession;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        THDevOpenHelper helper = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; THDevOpenHelper(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;test.db&quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SQLiteDatabase sqLiteDatabase = helper.getWritableDatabase();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        daoMaster = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoMaster(sqLiteDatabase);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        daoSession = daoMaster.newSession();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; DaoMaster &lt;span class=&quot;title&quot;&gt;getDaoMaster&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; daoMaster;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; DaoSession &lt;span class=&quot;title&quot;&gt;getDaoSession&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; daoSession;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;假如是从版本1升级到版本2，就在 &lt;strong&gt;&lt;em&gt;DaoMaster&lt;/em&gt;&lt;/strong&gt; 里将 &lt;strong&gt;&lt;em&gt;SCHEMA_VERSION&lt;/em&gt;&lt;/strong&gt; 的值改为2（默认为1）&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DaoMaster&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AbstractDaoMaster&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; SCHEMA_VERSION = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在 &lt;strong&gt;&lt;em&gt;THDevOpenHelper&lt;/em&gt;&lt;/strong&gt; 的 &lt;strong&gt;&lt;em&gt;onUpgrade&lt;/em&gt;&lt;/strong&gt; 方法里写需要执行的 SQL 语句，执行升级操作。这段 Java 代码，相信也都能看得懂。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onUpgrade&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(SQLiteDatabase db, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; oldVersion, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; newVersion)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (oldVersion) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 创建新表&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            NewUserDao.createTable(db, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 加入新字段&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            db.execSQL(&lt;span class=&quot;string&quot;&gt;&quot;ALTER TABLE &#39;USER&#39; ADD &#39;USER_NAME&#39; TEXT;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 删除表&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            UserDao.dropTable(db, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Log.i(&lt;span class=&quot;string&quot;&gt;&quot;greenDAO&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Upgrading schema from version &quot;&lt;/span&gt; + oldVersion + &lt;span class=&quot;string&quot;&gt;&quot; to &quot;&lt;/span&gt; + newVersion);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;##List in Object 的存取&lt;/p&gt;
&lt;p&gt;正常的基本数据类型的存取，相信有很多同学也都卡在这一块儿了，甚至听有人讲过，不能存取带 List 的 Object 的 orm 跟不用 orm 没差别。而恰恰 &lt;strong&gt;&lt;em&gt;greenDAO&lt;/em&gt;&lt;/strong&gt; 在这块儿做的非常好，代码看起来非常直观。废话不多说，直接上代码。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Star&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String userId;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String userName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String userPic;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String userIntro;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String userCity;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String userAddress;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;Klass&amp;gt; klassList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Klass&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样的实体类要怎么存取？默认大家都是通过另外一个 Java Generator 工程里生成的 &lt;strong&gt;&lt;em&gt;dao&lt;/em&gt;&lt;/strong&gt; 和 &lt;strong&gt;&lt;em&gt;entity&lt;/em&gt;&lt;/strong&gt;，对于这样的实体，我们只需这样做即可&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CustomDaoGenerator&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Schema schema = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Schema(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;db.greendao.entity&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		schema.enableKeepSectionsByDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		schema.setDefaultJavaPackageDao(&lt;span class=&quot;string&quot;&gt;&quot;db.greendao.dao&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		addNote(schema);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoGenerator().generateAll(schema, &lt;span class=&quot;string&quot;&gt;&quot;/Users/liang/Documents/AndroidDemo/DaoGenerator&quot;&lt;/span&gt;);&lt;span class=&quot;comment&quot;&gt;//这里替换成你想把 dao 和 entity 存储的路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addNote&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Schema schema)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		createStarsTable(schema);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;createStarsTable&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Schema schema)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Entity star = schema.addEntity(&lt;span class=&quot;string&quot;&gt;&quot;Star&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;).primaryKey();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;userId&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;userName&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;userPic&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;userIntro&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;userCity&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;userAddress&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Entity klass = schema.addEntity(&lt;span class=&quot;string&quot;&gt;&quot;Klass&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		klass.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Property klassInStar = klass.addStringProperty(&lt;span class=&quot;string&quot;&gt;&quot;star_id&quot;&lt;/span&gt;).notNull().getProperty();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		klass.addToOne(star, klassInStar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		star.addToMany(klass, klassInStar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后我们可以看看生成的实体类与只有基本数据类型的实体类有什么区别&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;202&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;203&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;204&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;205&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;206&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;207&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;208&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;209&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;210&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;211&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;212&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;213&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;214&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Klass&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Not-null value. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Used to resolve relations */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;transient&lt;/span&gt; DaoSession daoSession;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Used for active entity operations. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;transient&lt;/span&gt; KlassDao myDao;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Star star;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String star__resolvedKey;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP FIELDS - put your custom fields here&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP FIELDS END&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Klass&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Klass&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String id, String star_id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.id = id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star_id = star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** called by internal mechanisms, do not call yourself. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__setDaoSession&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DaoSession daoSession)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.daoSession = daoSession;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao = daoSession != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? daoSession.getKlassDao() : &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.id = id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Not-null value. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getStar_id&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Not-null value; ensure this value is available before it is saved to the database. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setStar_id&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String star_id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star_id = star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** To-one relationship, resolved on first access. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Star &lt;span class=&quot;title&quot;&gt;getStar&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String __key = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (star__resolvedKey == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || star__resolvedKey != __key) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (daoSession == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            StarDao targetDao = daoSession.getStarDao();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Star starNew = targetDao.load(__key);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                star = starNew;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            	star__resolvedKey = __key;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; star;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setStar&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Star star)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (star == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;To-one property &#39;star_id&#39; has not-null constraint; cannot set to-one to null&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star = star;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            star_id = star.getId();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            star__resolvedKey = star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Convenient call for &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; AbstractDao#delete(Object)&amp;#125;. Entity must attached to an entity context. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (myDao == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao.delete(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Convenient call for &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; AbstractDao#update(Object)&amp;#125;. Entity must attached to an entity context. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (myDao == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao.update(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Convenient call for &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; AbstractDao#refresh(Object)&amp;#125;. Entity must attached to an entity context. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;refresh&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (myDao == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao.refresh(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP METHODS - put your custom methods here&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP METHODS END&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Klass&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Not-null value. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Used to resolve relations */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;transient&lt;/span&gt; DaoSession daoSession;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Used for active entity operations. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;transient&lt;/span&gt; KlassDao myDao;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Star star;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String star__resolvedKey;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP FIELDS - put your custom fields here&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP FIELDS END&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Klass&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Klass&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String id, String star_id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.id = id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star_id = star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** called by internal mechanisms, do not call yourself. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__setDaoSession&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DaoSession daoSession)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.daoSession = daoSession;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao = daoSession != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? daoSession.getKlassDao() : &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.id = id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Not-null value. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getStar_id&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Not-null value; ensure this value is available before it is saved to the database. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setStar_id&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String star_id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star_id = star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** To-one relationship, resolved on first access. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Star &lt;span class=&quot;title&quot;&gt;getStar&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String __key = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (star__resolvedKey == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || star__resolvedKey != __key) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (daoSession == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            StarDao targetDao = daoSession.getStarDao();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Star starNew = targetDao.load(__key);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                star = starNew;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            	star__resolvedKey = __key;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; star;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setStar&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Star star)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (star == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;To-one property &#39;star_id&#39; has not-null constraint; cannot set to-one to null&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.star = star;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            star_id = star.getId();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            star__resolvedKey = star_id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Convenient call for &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; AbstractDao#delete(Object)&amp;#125;. Entity must attached to an entity context. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (myDao == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao.delete(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Convenient call for &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; AbstractDao#update(Object)&amp;#125;. Entity must attached to an entity context. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (myDao == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao.update(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/** Convenient call for &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; AbstractDao#refresh(Object)&amp;#125;. Entity must attached to an entity context. */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;refresh&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (myDao == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DaoException(&lt;span class=&quot;string&quot;&gt;&quot;Entity is detached from DAO context&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        myDao.refresh(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP METHODS - put your custom methods here&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// KEEP METHODS END&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;存取的时候，按照下面的步骤来就可以了&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;StarDao starDao = daoSession.getStarDao();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;KlassDao klassDao = daoSession.getKlassDao();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Star star = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Star();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Klass klass1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Klass();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Klass klass2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Klass();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Klass klass3 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Klass();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;klass1.setStar(star);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;klass2.setStar(star);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;klass2.setStar(star);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;klassDao.insert(klass1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;klassDao.insert(klass2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;klassDao.insert(klass3);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;starDao.insert(star);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;Star&amp;gt; stars = starDao.loadAll();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Star starEntity : stars) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Klass klass : starEntity.getKlassList()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.i(&lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;, klass.id);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;OK，打完收工。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;greenDAO 这么牛逼的库，很多人因为一些误解而放弃使用它，真的很可惜，同时也确实，有很多博客都在介绍 greenDAO 的使用，但是不得不说一些风气很不好，基本上都是官方文档上的 sample 自己照着抄一遍，然后就成文发布了，最让人困惑的一些问题一个都没涉及到。我大致总结了一下，不少人遇到的无非两个问题，升级和带 List 的 Object 的存取，算是记录一下。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.easydone.cn/tags/Android/"/>
    
      <category term="greenDAO" scheme="http://www.easydone.cn/tags/greenDAO/"/>
    
  </entry>
  
  <entry>
    <title>给RecyclerView最纯粹的下拉刷新和上拉加载更多</title>
    <link href="http://www.easydone.cn/2015/10/26/"/>
    <id>http://www.easydone.cn/2015/10/26/</id>
    <published>2015-10-26T12:39:25.000Z</published>
    <updated>2015-12-15T02:24:21.000Z</updated>
    
    <content type="html">&lt;p&gt;RecyclerView 出现以后，Android 里的下拉刷新和加载更多实现起来就非常容易了。当然，现成的库也有很多，只是总会有不一样的需求，而且我们往往只需要最基本的下拉刷新和加载更多功能，而不需要其他多余的功能。我只需要一个最纯粹的下拉刷新和加载更多。所以，自己动手显然是最好的结果了，也算是个小练习。总结起来，无非两点，一是用 &lt;strong&gt;&lt;em&gt;SwipeRefreshLayout&lt;/em&gt;&lt;/strong&gt; 包裹 &lt;strong&gt;&lt;em&gt;RecyclerView&lt;/em&gt;&lt;/strong&gt; 实现下拉刷新，二是滑倒底部的时候自动加载实现加载更多。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;需要注意的是两点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;下拉刷新是通过实现 &lt;strong&gt;&lt;em&gt;SwipeRefreshLayout.OnRefreshListener &lt;/em&gt;&lt;/strong&gt; 接口来实现的，也就是说下拉刷新具有了通用性，不只是 &lt;strong&gt;&lt;em&gt; RecyclerView &lt;/em&gt;&lt;/strong&gt;;&lt;/li&gt;
&lt;li&gt;加载更多要通过 &lt;strong&gt;&lt;em&gt; LinearLayoutManager &lt;/em&gt;&lt;/strong&gt;来获取 &lt;strong&gt;&lt;em&gt;RecyclerView &lt;/em&gt;&lt;/strong&gt;是否滑动到底部来实现。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这样我们就把问题分解了。第一步，我们先看最简单的下拉刷新，由于代码过于简单，我就直接贴代码了。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setContentView(R.layout.activity_main);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setSupportActionBar(toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    swipeRefreshLayout = (SwipeRefreshLayout) findViewById(R.id.swipe_refresh_layout);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    swipeRefreshLayout.setColorSchemeResources(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            R.color.google_blue,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            R.color.google_green,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            R.color.google_red,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            R.color.google_yellow&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recyclerView = (RecyclerView) findViewById(R.id.recycler_view);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    LinearLayoutManager linearLayoutManager = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinearLayoutManager(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recyclerView.setHasFixedSize(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recyclerView.setLayoutManager(linearLayoutManager);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setData();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RefreshAdapter refreshAdapter = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RefreshAdapter(mList, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recyclerView.setAdapter(refreshAdapter);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    swipeRefreshLayout.setOnRefreshListener(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mList = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mList.add(&lt;span class=&quot;string&quot;&gt;&quot;第&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;个&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onRefresh&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Observable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .timer(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, TimeUnit.SECONDS, AndroidSchedulers.mainThread())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .map(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Func1&amp;lt;Long, Object&amp;gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Long aLong)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    fetchingNewData();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    swipeRefreshLayout.setRefreshing(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    refreshAdapter.notifyDataSetChanged();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Refresh Finished!&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;).subscribe();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fetchingNewData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mList.add(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;下拉刷新出来的数据&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后就是加载更多功能，RecyclerView 有一个方法 &lt;strong&gt;&lt;em&gt; addOnScrollListener &lt;/em&gt;&lt;/strong&gt;，我们只要传入一个 &lt;strong&gt;&lt;em&gt;RecyclerView.OnScrollListener &lt;/em&gt;&lt;/strong&gt; 就可以实现加载更多了，但是事实是为了充分保证 RecyclerView 的灵活性，Android 本身是没有对这个滑动接口做处理的，需要我们自定义个加载更多的接口去实现它，然后才能真正实现加载更多。实现起来也很简单，我们只要重写 &lt;strong&gt;&lt;em&gt; onScrolled &lt;/em&gt;&lt;/strong&gt; 方法即可。下面是一个封装好的加载更多的接口实现类，然后作为参数传进去就好了。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;EndlessRecyclerOnScrollListener&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;title&quot;&gt;RecyclerView&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;OnScrollListener&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; previousTotal = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; loading = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; firstVisibleItem, visibleItemCount, totalItemCount;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; currentPage = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; LinearLayoutManager mLinearLayoutManager;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;EndlessRecyclerOnScrollListener&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            LinearLayoutManager linearLayoutManager)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.mLinearLayoutManager = linearLayoutManager;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onScrolled&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(RecyclerView recyclerView, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; dx, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; dy)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onScrolled(recyclerView, dx, dy);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        visibleItemCount = recyclerView.getChildCount();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        totalItemCount = mLinearLayoutManager.getItemCount();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        firstVisibleItem = mLinearLayoutManager.findFirstVisibleItemPosition();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (loading) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (totalItemCount &amp;gt; previousTotal) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                loading = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                previousTotal = totalItemCount;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!loading&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;amp;&amp;amp; (totalItemCount - visibleItemCount) &amp;lt;= firstVisibleItem) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            currentPage++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            onLoadMore(currentPage);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            loading = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onLoadMore&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; currentPage)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后就是具体的加载更多的实现逻辑了。&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;recyclerView.addOnScrollListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EndlessRecyclerOnScrollListener(linearLayoutManager) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onLoadMore&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; currentPage)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        simulateLoadMoreData();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;simulateLoadMoreData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Observable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .timer(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, TimeUnit.SECONDS, AndroidSchedulers.mainThread())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .&lt;span class=&quot;built_in&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Func1&amp;lt;Long, Object&amp;gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                @&lt;span class=&quot;function&quot;&gt;Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Long aLong)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    loadMoreData();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    stringAdapter.notifyDataSetChanged();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Load Finished!&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;).subscribe();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;loadMoreData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; moreList = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        moreList.add(&lt;span class=&quot;string&quot;&gt;&quot;加载更多的数据&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mList.addAll(moreList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样，下拉刷新和加载更多就实现了，就这么简单。&lt;/p&gt;
&lt;p&gt;当然，如果你想要一个加载更多的 &lt;strong&gt;&lt;em&gt; ProgressBar &lt;/em&gt;&lt;/strong&gt; 展示的话，可以给&lt;strong&gt;&lt;em&gt; RecyclerView &lt;/em&gt;&lt;/strong&gt; 添加一个 Footer ，用来展示加载更多的过程。GitHub 上搜索一下会有很多实现方案，这里我随便贴一个作为例子。&lt;a href=&quot;https://gist.github.com/darnmason/7bbf8beae24fe7296c8a&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;HeaderViewRecyclerAdapter&lt;/a&gt;，一个用起来相当方便的 Gist ，如果用在上面的例子里就会是这样：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HeaderViewRecyclerAdapter stringAdapter = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HeaderViewRecyclerAdapter(refreshAdapter);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;recyclerView.setAdapter(stringAdapter);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;createLoadMoreView();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;createLoadMoreView&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    View loadMoreView = LayoutInflater&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .from(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .inflate(R.layout.view_load_more, recyclerView, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stringAdapter.addFooterView(loadMoreView);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后把对应的 adapter 替换以后即可。代码看这里&lt;a href=&quot;https://github.com/liangzhitao/SwipeRefreshRecyclerView&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SwipeRefreshRecyclerView&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我们可以看到运行效果非常完美&lt;br&gt;&lt;img src=&quot;http://7x2wvb.com1.z0.glb.clouddn.com/RefreshRecyclerView.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;RecyclerView 出现以后，Android 里的下拉刷新和加载更多实现起来就非常容易了。当然，现成的库也有很多，只是总会有不一样的需求，而且我们往往只需要最基本的下拉刷新和加载更多功能，而不需要其他多余的功能。我只需要一个最纯粹的下拉刷新和加载更多。所以，自己动手显然是最好的结果了，也算是个小练习。总结起来，无非两点，一是用 &lt;strong&gt;&lt;em&gt;SwipeRefreshLayout&lt;/em&gt;&lt;/strong&gt; 包裹 &lt;strong&gt;&lt;em&gt;RecyclerView&lt;/em&gt;&lt;/strong&gt; 实现下拉刷新，二是滑倒底部的时候自动加载实现加载更多。
    
    </summary>
    
      <category term="Android" scheme="http://www.easydone.cn/categories/Android/"/>
    
    
      <category term="RecyclerView" scheme="http://www.easydone.cn/tags/RecyclerView/"/>
    
      <category term="下拉刷新" scheme="http://www.easydone.cn/tags/%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0/"/>
    
      <category term="加载更多" scheme="http://www.easydone.cn/tags/%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A/"/>
    
  </entry>
  
  <entry>
    <title>关于“提问”</title>
    <link href="http://www.easydone.cn/2015/09/19/"/>
    <id>http://www.easydone.cn/2015/09/19/</id>
    <published>2015-09-19T03:41:47.000Z</published>
    <updated>2015-12-15T02:24:28.000Z</updated>
    
    <content type="html">&lt;p&gt;就单单从我自己的学习经历来看，也可能确实是在自己的智商实在有限，没有天赋，无论学习什么都很慢，尤其是在 IT 行业做技术，更是如此，一个没有任何基础的人如果想做出一点成绩，除了付出比别人更多的努力，别无他法。而这个行业里，技术圈子里，往往有不少伸手党，把整个圈子的学术氛围搞的很糟糕，以至于许多新人，即使不是伸手党，也容易被人误解为伸手党。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我深知自己一路走来遭遇到的困难，当然，自己如今也仍然是菜鸟一只，并没有任何值得夸耀的成绩，对于初入行业的新人所多出来的，也仅仅是一些入门的技巧和看上去笨拙异常的学习方法。当然，学习方法还是因人而异。前段时候，听到有人评价我给人讲问题很耐心，自己也稍觉着有些许欣慰。与自己一直以来遇到的人相比，自己毕业的大学简直是一坨屎；对比在学校里的取得的成绩，更加不值一提；我很明白自己与绝大多数人的差距。对于一些新人在学习上的一些困惑，自己也只是稍微早一些时候有了了解，并不见得自己就真的能力比人强多少，这点自知之明我还是有的。&lt;/p&gt;
&lt;p&gt;遇到过不少很有潜力，基础很扎实，在校表现非常优秀的高学历毕业生，无论哪一项放在我面前，都足以让自己无地自容。然而他们中的不少欠缺的只是面对问题的良好心态。经常看到他们一看到一个仅仅是看上去稍微复杂的问题，就想着怎么退缩，怎么回避这些困难。这时候，经常他们向自己仰慕的大牛们请教，往往得到只有一个词：Google ！我不知道这个行业怎么会演变成这个样子，也许大牛们真的都很忙。从我自己的学习经历来看，由于自己学历和入行晚的问题，实在不好意思向别人请教，偶尔请教一次也是闭门羹，索性就自己慢慢琢磨，各种艰辛也只有自己最清楚。&lt;/p&gt;
&lt;p&gt;我觉着很多情况下，一个新人问出来一些看似很低级的问题，问题可能并不在于他习惯性伸手党，而在于引导他面对困难的处理方式是否正确，也许他此时的想法已经对了，只是面对未知不敢去尝试，如果你告诉他：“相信自己的判断，这东西并没有你想象中的那么难，尽力去尝试。”这样会单纯地撂出一个：“Google ！”要好的多。而多说几句话，其实并不会耽误多少工夫。&lt;/p&gt;
&lt;p&gt;没人愿意去做伸手党，在这个行业里做技术本就已经很艰难，即使是老手，每天也要面对无穷无尽的不合理的需求，要面对领导对项目进度的苛刻态度，过着看不到头的 996 的日子，甚至有随时被炒鱿鱼的风险，对于一个有经验的人，尚且如此大的压力，那对于新人，甚至是实习生是不是该更加有一点耐心呢？&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;就单单从我自己的学习经历来看，也可能确实是在自己的智商实在有限，没有天赋，无论学习什么都很慢，尤其是在 IT 行业做技术，更是如此，一个没有任何基础的人如果想做出一点成绩，除了付出比别人更多的努力，别无他法。而这个行业里，技术圈子里，往往有不少伸手党，把整个圈子的学术氛围搞的很糟糕，以至于许多新人，即使不是伸手党，也容易被人误解为伸手党。
    
    </summary>
    
    
      <category term="学习" scheme="http://www.easydone.cn/tags/%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="提问" scheme="http://www.easydone.cn/tags/%E6%8F%90%E9%97%AE/"/>
    
  </entry>
  
</feed>
